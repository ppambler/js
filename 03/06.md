### âœï¸ Tangxt â³ 2021-02-26 ğŸ·ï¸ å¯å“åº”å¯¹è±¡

# 06-å¯å“åº”å¯¹è±¡-1

1ï¼‰ä¸¤ä¸ªé—®é¢˜

ğŸ’¡ï¼šwebsocket å¦‚æœå‘é€çš„æ•°æ®é‡å¾ˆå¤§çš„è¯ï¼Œæ˜¯ä¸æ˜¯è¦è€ƒè™‘æ‹†åŒ…ï¼Œç²˜åŒ…çš„é—®é¢˜ï¼Ÿ

websocket è‡ªå·±ä¼šæ‹†ï¼Œä¸ç”¨æˆ‘ä»¬æ‹† -> è·¯ç”±ä¼šæœ‰ä¸€ä¸ªæ•°æ®é‡ä¸Šé™å€¼ï¼å®ƒæƒ³ä¸æ‹†éƒ½ä¸è¡Œï¼

ğŸ’¡ï¼šreduce -> polyfillï¼ˆä¿®è¡¥ï¼‰ï¼Ÿ

æ€§èƒ½ -> ç³»ç»Ÿå®ç°çš„æ¯”æˆ‘ä»¬è‡ªå·±å®ç°çš„è¦é«˜å¾—å¤šï¼å› ä¸ºå®ƒæ˜¯ç”¨åŸç”Ÿè¯­è¨€å®ç°çš„ï¼

å®ƒçš„ç‰¹ç‚¹ï¼š

* æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ callbackï¼Œç¬¬äºŒä¸ªæ˜¯åˆå§‹å€¼
  + callback çš„å½¢å‚
    - accumulator -> ç´¯ç§¯èƒ½é‡
    - currentValue -> å…ƒç´ 
    - currentIndex -> ç´¢å¼•
    - array -> æºæ•°ç»„
* å¦‚æœä¸ç»™åˆå§‹å€¼ï¼Œé‚£ä¹ˆå¾ªç¯æ˜¯ä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹çš„ï¼›å¦‚æœç»™äº†ï¼Œé‚£ä¹ˆå¾ªç¯æ˜¯ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹çš„

å®ç°ï¼š

``` js
Array.prototype.reduce =
  Array.prototype.reduce ||
  function(cb, initialValue) {
    var start = 0;
    if (typeof initialValue == "undefined") {
      initialValue = this[0];
      start = 1;
    }

    for (start; start < this.length; start++) {
      // å‡½æ•° -> è¡¨è¾¾å¼ -> æ±‚å€¼
      initialValue = cb(initialValue, this[start], start);
    }

    return initialValue;
  };

let arr = [12, 5, 7, 9];
let sum = arr.reduce(function(tmp, item, index) {
  return tmp + item;
}, 99);
let arr1 = [1, 2, 3]
let sum1 = arr1.reduce((tmp, item) => {
  return tmp + item
})

console.log(sum);
console.log(sum1)
```

mdn æ–‡æ¡£ä¹Ÿæœ‰å…³äº reduce çš„ polyfill å®ç°

â¹ï¼š[Array.prototype.reduce() - JavaScript - MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce)

2ï¼‰å›é¡¾

* é¢å‘å¯¹è±¡
* ç»§æ‰¿
  + é‡ç”¨çˆ¶çº§ä»£ç 
  + å¤šæ€ -> è®©ä»£ç æ›´ç®€å•
  + å±‚æ¬¡ -> åƒ HTML æ ‡ç­¾åµŒå¥—é‚£æ ·
* é‡ç”¨çˆ¶çº§ä»£ç 
  + ç»§æ‰¿ -> æœ€å¸¸ç”¨
  + ç»„åˆ -> æœ‰äº›åœºæ™¯ç”¨å®ƒ -> å¤šé‡ç»§æ‰¿

è¿™èŠ‚è¯¾è®²ä»€ä¹ˆï¼Ÿ

1. é«˜é˜¶ç±»â€”â€”åå‘ç»§æ‰¿ï¼ˆä¸æ˜¯å­ç±»ç»§æ‰¿çˆ¶ç±»ï¼Œç„¶åçˆ¶çº§ç»§æ‰¿å­ç±»è¿™ç§åå‘ï¼‰ï¼Œåœ¨çˆ¶çº§ä¸­ä½¿ç”¨å­ç±»çš„æˆå‘˜ -> ä¸€ç§å¾ˆæœ‰æ„æ€çš„æ€æƒ³ -> ç”¨é€”ä¸å¹¿ï¼Œä½†å¶å°”ç”¨å®ƒéå¸¸ä¸é”™
2. å¯å“åº”å¯¹è±¡ -> åªè¦ç»™ç±»çš„å®ä¾‹çš„æŸä¸€ä¸ªå±æ€§ï¼ˆæ³¨æ„æ˜¯å±æ€§ï¼Œå¯ä¸æ˜¯æ–¹æ³•ï¼‰èµ‹å€¼ï¼Œå®ä¾‹çš„å†…éƒ¨å°±èƒ½æ„ŸçŸ¥åˆ°ï¼Œæœ‰äººå¯¹å®ƒçš„å±æ€§æ€ä¹ˆæ€ä¹ˆæ ·äº†ï¼ -> çŸ¥é“äº†ï¼Œå°±ä¼šä½œå‡ºç›¸åº”çš„ååº”ï¼ -> **å¾ˆé‡è¦**

   1. æ–¹ä¾¿å—ï¼Ÿ -> æ–¹ä¾¿ä¸å‘åŒåœ¨ï¼

ğŸ’¡ï¼šåªæœ‰ JS æœ‰é«˜é˜¶ç±»å—ï¼Ÿ

å…¶å®ƒè¯­è¨€ä¹Ÿæœ‰ï¼Œä½†å®ç°æ¯”è¾ƒè´¹åŠ²ï¼Œå¦‚ Javaï¼Œå¯¹äº JS è¿™ç§åŠ¨æ€è„šæœ¬è¯­è¨€æ¥è¯´ï¼Œso easyï¼

ğŸ’¡ï¼šåŠ¨æ€è¯­è¨€å’Œé™æ€è¯­è¨€æ€ä¹ˆåŒºåˆ†å•Šï¼Ÿ

ä»€ä¹ˆå«åŠ¨æ€ï¼Ÿ

`class` æ˜¯è¿™æ ·å†™çš„ï¼š

``` js
class A {
  a = 12
}

let obj = new A()
console.log(obj) // {a:12}
```

æˆ‘ä»¬å¯ä»¥ä¸º `obj` æ·»åŠ å±æ€§ï¼š

``` js
obj.b = 666
```

è¿™å°±æ˜¯åŠ¨æ€çš„ï¼

è€Œå¦‚æœæ˜¯ Java è¯­è¨€çš„è¯ï¼Œæ˜¯ä¸èƒ½è¿™æ ·æ·»åŠ çš„ï¼Œä½ å¾—æ”¹ `class` æ‰èƒ½æ·»åŠ ï¼Œè€Œ JS å°±ä¸ç”¨è¿™æ ·åšäº†ï¼

è¿™ä¸ªä¾‹å­åªæ˜¯åŒºåˆ†åŠ¨æ€å’Œé™æ€çš„ä¸€ä¸ªæ¯”è¾ƒçªå‡ºçš„ç‚¹ï¼ä½†è¿™ä¹Ÿè¶³å¤Ÿè§£é‡ŠåŠ¨æ€ï¼ˆæ´»çš„ï¼Œéšä¾¿æ”¹ï¼‰å’Œé™æ€ï¼ˆä¸èƒ½æ”¹ï¼‰äº†ï¼

3ï¼‰HOC é«˜é˜¶ç±»

ä¸€èˆ¬æ¥è¯´ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»æ˜¯å¤©ç»åœ°ä¹‰çš„ä¸€ä»¶äº‹å„¿ï¼

é‚£é«˜é˜¶ç±»ã€Œé«˜ã€åœ¨å“ªå„¿å‘¢ï¼Ÿ -> çˆ¶ç±»å¯ä»¥åè¿‡æ¥ä½¿ç”¨å­ç±»çš„ä¸œè¥¿ï¼ï¼ˆæ„Ÿè§‰å¾ˆå‰å®³çš„æ ·å­ï¼Œä½†è¿™ä¸ªæ“ä½œä¹Ÿæ„Ÿåˆ°å¾ˆåˆ«æ‰­ï¼‰

å®ƒä¸å¸¸ç”¨ï¼Œä½†å¶å°”åœ¨æ°å½“çš„æ—¶å€™ç”¨å®ƒä¸€æ¬¡ï¼Œä¼šå¯¹æˆ‘ä»¬æœ‰æå¤§çš„å¸®åŠ©ï¼

![ç”¨å­ç±»çš„ä¸œè¥¿](assets/img/2021-02-26-17-27-14.png)

å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä»£ç ä¼¼ä¹æŒºç®€å•çš„ï¼Œå¯å®ƒå±…ç„¶èµ·æ¥ä¸€ä¸ªå«ã€Œé«˜é˜¶ç±»ã€çš„åå­—ï¼

å®ƒçš„ä½¿ç”¨åœºæ™¯ï¼šç»„ä»¶ä¹‹é—´çš„æ•°æ®äº¤äº’ï¼ˆäº¤æµï¼‰

Store.jsï¼š

``` js
// Store.js
class Store {
  constructor() {
    this._state = {};
  }

  get(key) {
    if (key in this._state) {
      return this._state[key];
    } else {
      throw new Error(`${key} is not defined`);
    }
  }

  set(key, val) {
    this._state[key] = val;
  }

  connect(cls) {
    let store = this;
    return class extends cls {
      constructor(...args) {
        super(...args);

        this.get = store.get.bind(store);
        this.set = store.set.bind(store);

        // this.get=store.get;
        // this.set=store.set;
      }
    };
  }
}

let store = new Store();
```

A.jsï¼š

``` js
const A = store.connect(
  class {
    constructor() {}
    getA() {
      console.log(this.get("a"));
    }
  }
);
```

B.jsï¼š

``` js
const B = store.connect(class {
  constructor() {}
  setA(val) {
    this.set('a', val);
  }
});
```

index.htmlï¼š

``` html
<body>
  <script src="./Store.js"></script>
  <script src="./A.js"></script>
  <script src="./B.js"></script>
  <script>
    let a = new A();
    let b = new B();

    b.setA(66);
    a.getA();
  </script>
</body>
```

> æ—¢ç„¶æœ‰åŒ¿åå‡½æ•°ï¼Œé‚£å°±ä¼šæœ‰åŒ¿å`class` -> `get`å’Œ`set`å¹¶ä¸æ˜¯`getter`å’Œ`setter`æ–¹æ³•

ç¨‹åºçš„å¤§æ¦‚æ€è·¯ï¼š

![é«˜é˜¶ç±»](assets/img/2021-02-26-19-44-19.png)

ğŸ’¡ï¼šsuper

åªè¦å‡ºç°äº† `extends` å°±å¾—æ‰‹åŠ¨è°ƒ `super` ï¼Œ `Object` é™¤å¤–ï¼

ğŸ’¡ï¼šå°ç»“

HOC é«˜é˜¶ç±»ï¼š

1. åœ¨çˆ¶ç±»ä¸­ä½¿ç”¨å­ç±»æ‰æœ‰çš„ä¸œè¥¿
2. ç±»å†™å®Œä¸ç›´æ¥ç”¨â€”â€”åŒ…è£¹ä¸€ä¸‹

4ï¼‰å¯å“åº”å¯¹è±¡

> é‡ç‚¹è¯é¢˜

- æ˜¯ä»€ä¹ˆï¼šå±æ€§å¯ä»¥è¢«ç›‘å¬
- ç›®çš„ï¼šä¸ºäº†æ–¹ä¾¿
- æ€ä¹ˆåšï¼Ÿ -> ä¸‰ç§å§¿åŠ¿
  - è®¿é—®å™¨â€”â€”get/set -> åœ¨ç®€å•åœºæ™¯ä½¿ç”¨
  - defineProperpty -> å¯ä»¥å¸®æˆ‘ä»¬æ·»åŠ è¢«ç›‘å¬çš„å±æ€§ï¼Œä½†æœ‰ç¼ºé™·
  - Proxy -> defineProperpty çš„åç»§ç‰ˆæœ¬ï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œæ¯” defineProperpty çš„ç›‘å¬èŒƒå›´è¿˜è¦å¹¿å¾—å¤šï¼Œè€Œä¸” defineProperpty çš„ä¸€äº›é—®é¢˜å®ƒè¿˜æ²¡æœ‰ -> äººç±»æ€»åœ¨è¿›æ­¥
    - å¥½ç”¨ï¼Œå¯ä»¥æŠŠä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§éƒ½ç»™ç›‘å¬äº†ï¼

ä¸ºä»€ä¹ˆè®²`defineProperpty`ï¼Ÿ -> å› ä¸ºè¿˜æœ‰äººç”¨ï¼Œä½†æˆ‘ä»¬ä¸»è¦è¿˜æ˜¯ç”¨`Proxy`

---

1ã€è®¿é—®å™¨

> å¦‚ä½•è®©ä¸€ä¸ªå±æ€§å“åº”æˆ‘çš„æ“ä½œï¼Ÿ

- `get xxx(){} / set xxx(){}`æ„æˆå¯¹`xxx`å±æ€§çš„è®¿é—®å™¨
  - get å’Œ set æ˜¯ JS é‡Œè¾¹ç‰¹æ®Šçš„è¯­æ³•ï¼Œå®ƒæ‰€å®šä¹‰çš„æ–¹æ³•ä¸æ˜¯é€šå¸¸æ„ä¹‰ä¸Šçš„æ–¹æ³•ï¼Œè€Œé€šå¸¸æ„ä¹‰çš„æ–¹æ³•æ˜¯ä¾›æˆ‘ä»¬è°ƒç”¨çš„ï¼Œè€Œæ·»åŠ äº†`get`å’Œ`set`ä¼šæŠŠæ–¹æ³•å˜æˆæ‰€è°“çš„è®¿é—®å™¨æ–¹æ³• -> æ‰€è°“çš„è®¿é—®å™¨æ–¹æ³•ï¼Œè¯´ç™½äº†ï¼Œå°±æ˜¯æŠŠ `xxx` å½“ä½œæ˜¯å˜é‡æ¥ç”¨ï¼Œè¯»å–æ—¶å€™ä¼š**è‡ªåŠ¨è°ƒç”¨**å®ƒçš„èƒŒåçš„é‚£ä¸ªæ–¹æ³•ï¼ï¼ˆè®©è®¿é—®å™¨æ–¹æ³•è‡ªå·±æ¥æï¼Œä¸ç”¨ä½ å»è°ƒç”¨ï¼‰ è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬ä»£ç å†™èµ·æ¥å°±æ¯”è¾ƒæ–¹ä¾¿äº†ï¼
  - åªèƒ½åœ¨é¢å‘å¯¹è±¡é‡Œè¾¹æï¼ -> `class/{}` -> å› ä¸ºåªæœ‰å®ƒä»¬å¯ä»¥æ·»åŠ æ–¹æ³•ï¼
- ä¸‹åˆ’çº¿å¼€å¤´æ„å‘³ç€ç§æœ‰å±æ€§ï¼Œè¡¨ç¤ºä¸è¦å»è®¿é—®ï¼Œä¸ç„¶ï¼Œä¼šæœ‰è«åå…¶å¦™çš„é”™è¯¯
- å…³è” -> è®©`getter`å…³è”ç§æœ‰å±æ€§`_xxx`ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä¸å…³è”ï¼ç›´æ¥è¿”å›ä¸€ä¸ªæ•°å€¼ï¼
  - è®¿é—®å™¨è¿”å›çš„æ˜¯`this._xxx`ï¼Œä¸ç„¶ï¼Œä½ å†™çš„æ˜¯`this.xxx`å°±ä¼šå†™å¾ªç¯äº† -> å› ä¸º`this.xxx`ä¹Ÿæ˜¯ä¸€ä¸ªè¯»æ“ä½œå•Šï¼
- é˜²ç«å¢™ -> çº¦æŸå±æ€§å¯ä»¥æ¥å—çš„ç±»å‹

ä¾‹å­ï¼š

![è®¿é—®å™¨](assets/img/2021-02-26-21-10-45.png)