### âœï¸ Tangxt â³ 2020-11-27 ğŸ·ï¸ DOM

# 01-DOM å°è£…-å¯¹è±¡é£æ ¼

å¯¹è±¡é£æ ¼ä¹Ÿå«å‘½åç©ºé—´é£æ ¼ï¼Œæˆ‘ä»¬åœ¨ `window` æ——ä¸‹æä¸ªå…¨å±€å±æ€§ `dom` ï¼Œé‚£ä¹ˆ `window.dom` å°±æ˜¯å‘½åç©ºé—´ã€‚

æˆ‘ä»¬å¯¹ `dom` è¿™ä¸ªå¯¹è±¡æ·»åŠ äº†ã€Œå¢åˆ æ”¹æŸ¥ã€åŠŸèƒ½ï¼Œä»¥æ­¤æ¥å®Œæˆå¯¹å…ƒç´ çš„ DOM æ“ä½œï¼æ¯•ç«ŸåŸç”Ÿ DOM API ä½¿ç”¨èµ·æ¥ä¸æ€ä¹ˆæ–¹ä¾¿ï¼

## â˜…æŸ¥

1ï¼‰dom.findï¼ˆè·å–èŠ‚ç‚¹ï¼‰

1ã€è·å–ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹

è¯­æ³•ï¼š

``` js
dom.findOne(selector[, container])
```

å‚æ•°ï¼š

* `selector`ï¼šå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªåŒ…å«å•ä¸ªæˆ–å¤šä¸ªåŒ¹é…çš„é€‰æ‹©å™¨çš„å­—ç¬¦ä¸²
* `container`ï¼šèŠ‚ç‚¹å¯¹è±¡ï¼ˆ`document`èŠ‚ç‚¹ or å…ƒç´ èŠ‚ç‚¹ï¼‰ï¼Œå¯é€‰ï¼Œé»˜è®¤å€¼æ˜¯`document`èŠ‚ç‚¹

è¿”å›å€¼ï¼š

* ä¸æŒ‡å®šé€‰æ‹©å™¨æˆ–é€‰æ‹©å™¨ç»„åŒ¹é…çš„ç¬¬ä¸€ä¸ª `Element`ï¼Œå¦‚æœæœªæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œé‚£å°±è¿”å›`null`

å®ç°ï¼š

``` js
{
  findOne(selector, container) {
    return (container || document).querySelector(selector)
  }
}
```

2ã€è·å–å¤šä¸ªå…ƒç´ èŠ‚ç‚¹

è¯­æ³•ï¼š

``` js
dom.find(selectors[, container])
```

å‚æ•°ï¼š

* `selector`ï¼šå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªåŒ…å«å•ä¸ªæˆ–å¤šä¸ªåŒ¹é…çš„é€‰æ‹©å™¨çš„å­—ç¬¦ä¸²
* `container`ï¼šèŠ‚ç‚¹å¯¹è±¡ï¼ˆ`document`èŠ‚ç‚¹ or å…ƒç´ èŠ‚ç‚¹ï¼‰ï¼Œå¯é€‰ï¼Œé»˜è®¤å€¼æ˜¯`document`èŠ‚ç‚¹

è¿”å›å€¼ï¼š

* ä¸€ä¸ªé™æ€çš„`NodeList`å¯¹è±¡ï¼Œå®ƒæœ‰ç€ä¸æŒ‡å®šé€‰æ‹©å™¨æˆ–é€‰æ‹©å™¨ç»„ç›¸åŒ¹é…çš„å…ƒç´ èŠ‚ç‚¹åˆ—è¡¨ï¼Œå¦‚æœæœªæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œé‚£å°±è¿”å›ä¸€ä¸ª`length`ä¸º`0`çš„`NodeList`å¯¹è±¡ï¼

å®ç°ï¼š

``` js
{
  find(selectors, container) {
    return (container || document).querySelectorAll(selectors)
  }
}
```

ğŸ’¡ï¼š `querySelector` ä¸ `querySelectorAll` çš„åŒºåˆ«ï¼Ÿ

``` html
<ul class="container">
  <li class="list" id="one">åˆ—è¡¨ 1</li>
  <li class="list">åˆ—è¡¨ 2</li>
  <li class="list" id="three">åˆ—è¡¨ 3</li>
</ul>
```

![åŒºåˆ«](assets/img/2020-11-27-18-18-34.png)

ğŸ’¡ï¼šä»€ä¹ˆæ˜¯ã€Œé™æ€çš„ã€ï¼Ÿ

é™æ€ `NodeList` å°±æ˜¯å¯¹åº•å±‚ `document` çš„æ›´æ”¹ä¸ä¼šå½±å“åˆ°è¿”å›çš„è¿™ä¸ª `NodeList` å¯¹è±¡ã€‚æ­¤æ—¶è¿”å›çš„ `NodeList` åªæ˜¯ `querySelectorAll()` æ–¹æ³•è¢«è°ƒç”¨æ—¶çš„**æ–‡æ¡£çŠ¶æ€çš„å¿«ç…§**ã€‚

``` js
var divs = document.querySelectorAll("div");
var i = 0;
while (i < divs.length) {
  document.body.appendChild(document.createElement("div"));
  i++;
}
```

åœ¨è¿™ç§æƒ…å†µä¸‹æ²¡æœ‰æ­»å¾ªç¯ï¼Œ `divs.length` çš„å€¼æ°¸è¿œä¸ä¼šæ”¹å˜ï¼Œä¸ä¼šå› ä¸ºæ–‡æ¡£çŠ¶æ€å˜åŒ–äº†ï¼Œä½¿å¾— `divs.length` ä¹Ÿå‘ç”Ÿå˜åŒ–äº†ã€‚

æ€»ä¹‹ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªã€Œå½¼æ¶ˆæˆ‘é•¿ã€çš„è¿‡ç¨‹

è€ŒåŠ¨æ€çš„ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä½ è·å¾—ä¸œè¥¿æ˜¯ä¼šå˜åŒ–çš„ï¼Œæ¯”å¦‚æ­¤åˆ»ä½ çš„é“¶è¡Œå¡é‡Œæœ‰ 100 å…ƒï¼Œä½†è¿‡å‡ å°æ—¶åï¼Œå®ƒå°±æœ‰ 200 å…ƒäº†ã€‚

â¹ï¼š[é™æ€ NodeList å’Œ åŠ¨æ€ NodeList çš„åŒºåˆ«_å‰ç«¯å­¦ä¹ ä¹‹è·¯ - SegmentFault æ€å¦](https://segmentfault.com/a/1190000008829267)

2ï¼‰dom.parentï¼ˆè·å–çˆ¶èŠ‚ç‚¹ï¼‰

è¯­æ³•ï¼š

``` js
dom.parent(node)
```

å‚æ•°ï¼š

* `node`ï¼šèŠ‚ç‚¹å¯¹è±¡

è¿”å›å€¼ï¼š

* æŒ‡å®šèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹

å®ç°ï¼š

``` js
{
  parent(node) {
    return node.parentNode;
  }
}
```

3ï¼‰dom.childrenï¼ˆè·å–å­å…ƒç´ ä»¬ï¼‰

è¯­æ³•ï¼š

``` js
dom.children(node)
```

å‚æ•°ï¼š

* `node`ï¼šèŠ‚ç‚¹å¯¹è±¡

è¿”å›å€¼ï¼š

* ä¸€ä¸ªåŠ¨æ€çš„ã€æœ‰åºçš„`HTMLCollection`ï¼Œå¦‚æœ`node`æ²¡æœ‰å­å…ƒç´ ï¼Œé‚£å°±è¿”å›`length`ä¸º`0`çš„ç©ºåˆ—è¡¨

å®ç°ï¼š

``` js
{
  children(node) {
    return node.children;
  }
}
```

4ï¼‰dom.siblingsï¼ˆè·å–åŒçº§èŠ‚ç‚¹ï¼‰

è¯­æ³•ï¼š

``` js
dom.siblings(node)
```

è¿”å›å€¼ï¼š

* æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰åŒçº§èŠ‚ç‚¹åˆ—è¡¨ï¼Œè¿”å›çš„å¯¹è±¡æ˜¯ Array

å®ç°ï¼š

``` js
siblings(node) {
  return Array.from(node.parentNode.children).filter((item) => item !== node);
}
```

> å¦‚ä½•æ‹¿åˆ°æ‰€æœ‰çš„å…„å¼Ÿå…ƒç´ èŠ‚ç‚¹ï¼Ÿ-> æ‰¾åˆ°çˆ¸çˆ¸ï¼Œæ‹¿åˆ°çˆ¸çˆ¸çš„æ‰€æœ‰å­å…ƒç´ èŠ‚ç‚¹ä»¬ï¼Œæ•°ç»„åŒ–ï¼Œè¿‡æ»¤æ‰æŒ‡å®šèŠ‚ç‚¹

5ï¼‰dom.previousï¼ˆè·å–ä¸Šä¸€ä¸ªç›¸é‚»èŠ‚ç‚¹ï¼‰

è¯­æ³•ï¼š

``` js
dom.previous(node)
```

å®ç°ï¼š

``` js
{
  previous(node) {
    let p = node.previousSibling;
    while (p && p.nodeType === 3) {
      p = p.previousSibling;
    }
    return p;
  }
}
```

> å…ƒç´ èŠ‚ç‚¹çš„ `nodeType` ä¸º `1` ï¼Œè€Œæ–‡æœ¬èŠ‚ç‚¹åˆ™æ˜¯ `3` ã€‚å¦‚æœæŒ‡å®šèŠ‚ç‚¹çš„å‰ä»»èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œé‚£å°±ç»§ç»­æŸ¥æ‰¾â€¦â€¦

ğŸ’¡ï¼š `Node.previousSibling` ï¼Ÿ

åªè¯»å±æ€§ï¼Œè¿”å›å…¶çˆ¶èŠ‚ç‚¹çš„ `childNodes` åˆ—è¡¨ä¸­çš„æ‰€æŒ‡å®šèŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæŒ‡å®šçš„èŠ‚ç‚¹æ˜¯è¯¥åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™è¿”å› `null`

6ï¼‰dom.nextï¼ˆè·å–åä¸€ä¸ªåŒçº§èŠ‚ç‚¹ï¼‰

è¯­æ³•ï¼š

``` js
dom.next(node)
```

å®ç°ï¼š

``` js
{
  next(node) {
    let n = node.nextSibling;
    while (n && n.nodeType === 3) {
      n = n.nextSibling;
    }
    return n;
  }
}
```

7ï¼‰dom.travelï¼ˆéå†èŠ‚ç‚¹ï¼‰

è¯­æ³•ï¼š

``` js
dom.travel(nodeList, callback)
```

> `callback` çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å½“å‰å…ƒç´ èŠ‚ç‚¹

å‚æ•°ï¼š

* `nodeList`ï¼šè¢«éå†çš„èŠ‚ç‚¹åˆ—è¡¨æˆ–å…ƒç´ é›†åˆ
* `callback`ï¼šéå†å¾—åˆ°ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹å¯¹è±¡ï¼Œå°±ä¼šæ‰§è¡Œä¸€æ¬¡`callback`

è¿”å›å€¼ï¼š

* `undefined`

å®ç°ï¼š

``` js
{
  travel(nodeList, callback) {
    for (let i = 0; i < nodeList.length; i++) {
      callback.call(null, nodeList[i]);
    }
  }
}
```

8ï¼‰dom.indexï¼ˆè·å–èŠ‚ç‚¹ç´¢å¼•ï¼‰

è¯­æ³•ï¼š

``` js
dom.index(node)
```

è¿”å›å€¼ï¼š

* æŒ‡å®šèŠ‚ç‚¹åœ¨å…¶çˆ¶èŠ‚ç‚¹ä¸­çš„ç´¢å¼•å€¼

å®ç°ï¼š

``` js
{
  index(node) {
    const nodeList = dom.children(dom.parent(node));
    for (let i = 0; i < nodeList.length; i++) {
      if (nodeList[i] === node) {
        return i;
      }
    }
  }
}
```

## â˜…å¢

1ï¼‰dom.createï¼ˆåˆ›å»ºèŠ‚ç‚¹ï¼‰

è¯­æ³•ï¼š

``` js
dom.create(string)
```

å‚æ•°ï¼š

* `string`ï¼šHTML ä»£ç ç‰‡æ®µå­—ç¬¦ä¸²ï¼Œå¦‚`'<p>æˆ‘æ˜¯æ®µè½</p>'`ï¼Œè¯·ä¿è¯è¯¥ç‰‡æ®µåªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹

è¿”å›å€¼ï¼š

* ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹ï¼ˆæ–‡æ¡£ç‰‡æ®µèŠ‚ç‚¹çš„å…ƒç´ èŠ‚ç‚¹åŒ–ï¼‰

å®ç°ï¼š

``` js
{
  create(string) {
    const template = document.createElement("template");
    template.innerHTML = string.trim();
    return template.content.firstChild;
  }
}
```

ğŸ’¡ï¼š `template` å…ƒç´ ï¼Ÿ

HTML `<template>` å…ƒç´ ä»£è¡¨æ ‡è®°ä¸­çš„ä¸€ä¸ªæ¨¡æ¿ï¼Œå®ƒåŒ…å«â€æ¨¡æ¿å†…å®¹â€ï¼›æœ¬è´¨ä¸Šæ˜¯ä¸€å¤§å—çš„æƒ°æ€§å¯å¤åˆ¶ DOMã€‚ å¯ä»¥æŠŠæ¨¡æ¿æƒ³è±¡æˆä¸€ä¸ªè„šæ‰‹æ¶çš„é›¶ä»¶ï¼ˆèºä¸é’‰ï¼‰ï¼Œåœ¨åº”ç”¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä½ éƒ½å¯ä»¥ä½¿ç”¨ï¼ˆå’Œé‡ç”¨ï¼‰å®ƒ

ä½ åœ¨å†™äº†ä¸€ä¸ª `template` å…ƒç´ ï¼Œé¡µé¢å¹¶ä¸ä¼šæ¸²æŸ“è¿™ä¸ªæ ‡ç­¾ï¼š

![template](assets/img/2020-11-27-23-55-10.png)

> è¯¥å…ƒç´ èŠ‚ç‚¹åº”è¯¥æ˜¯å‚ä¸äº† DOM æ ‘çš„æ„å»º

æµ‹è¯•ä¾‹å­ï¼š

``` html
<template id="tem">
  <div id="div1">æˆ‘æ˜¯ template</div>
  <div>æˆ‘æ˜¯ template</div>
</template>
<script>
  let o = document.getElementById("tem");
  console.log(o.content.nodeName); //#document-fragment
  console.log(o.content.querySelectorAll("div")); //NodeList(2) [div#div1, div]ã€‚å¾—åˆ°ä¸€ä¸ªç±»æ•°ç»„
  console.log(o.content.getElementById("div1")); //<div id="div1">æˆ‘æ˜¯ template</div>
  console.log(o.innerHTML); //'<div id="div1">æˆ‘æ˜¯ template</div><div>æˆ‘æ˜¯ template</div>'
</script>
```

2ï¼‰dom.beforeï¼ˆå‘å‰æ’å…¥èŠ‚ç‚¹ï¼‰

è¯­æ³•ï¼š

``` js
dom.before(node, referenceNode)
```

å‚æ•°ï¼š

* `node`ï¼šæŒ‡å®šè¦æ’å…¥çš„èŠ‚ç‚¹
* `referenceNode`ï¼šå‚è€ƒèŠ‚ç‚¹å¯¹è±¡ï¼Œå¯ç®€å•ç†è§£æˆå¤„åœ¨åæ ‡ä¸º 0 çš„èŠ‚ç‚¹ï¼ˆä¸€ç»´åæ ‡ç³»ï¼‰

å®ç°ï¼š

``` js
{
  before(node, referenceNode) {
    dom.parent(referenceNode).insertBefore(node, referenceNode);
  }
}
```

3ï¼‰dom.afterï¼ˆå‘åæ’å…¥èŠ‚ç‚¹ï¼‰

è¯­æ³•ï¼š

``` js
dom.after(node, referenceNode)
```

å®ç°ï¼š

``` js
{
  after(node, referenceNode) {
    dom.parent(referenceNode).insertBefore(node, dom.next(referenceNode));
  }
}
```

4ï¼‰dom.appendï¼ˆæ’å…¥å­èŠ‚ç‚¹ï¼‰

æ‰¾åˆ°æŸä¸ªèŠ‚ç‚¹ï¼ŒæŠŠæŒ‡å®šèŠ‚ç‚¹ä½œä¸ºå®ƒçš„å­èŠ‚ç‚¹æ’å…¥å…¶ä¸­

è¯­æ³•ï¼š

``` js
dom.append(node, parentNode)
```

å®ç°ï¼š

``` js
{
  append(node, parentNode) {
    parentNode.appendChild(node);
  }
}
```

5ï¼‰dom.wrapï¼ˆæ’å…¥çˆ¶èŠ‚ç‚¹ï¼‰

æ‰¾åˆ°æŸä¸ªèŠ‚ç‚¹ï¼ŒæŒ‡å®šèŠ‚ç‚¹è®¤å®ƒä¸ºå¹²å„¿å­

è¯­æ³•ï¼š

``` js
dom.wrap(node, childNode)
```

å®ç°ï¼š

``` js
{
  wrap(node, childNode) {
    dom.before(node, childNode);
    dom.append(childNode, node);
  }
}
```

> æˆ‘å½“ä½ æ˜¯ä½ å…„å¼Ÿï¼Œä½ å±…ç„¶æƒ³è®©æˆ‘å«ä½ çˆ¸çˆ¸ï¼Ÿ

## â˜…åˆ 

1ï¼‰dom.removeï¼ˆåˆ é™¤èŠ‚ç‚¹ï¼‰

åˆ é™¤æŒ‡å®šèŠ‚ç‚¹ï¼Œå¹¶è¿”å›è¢«åˆ é™¤çš„æŒ‡å®šèŠ‚ç‚¹

è¯­æ³•ï¼š

``` js
dom.remove(node)
```

å®ç°ï¼š

``` js
{
  remove(node) {
    node.remove();
    return node;
  }
}
```

2ï¼‰dom.emptyï¼ˆæ¸…ç©ºå­èŠ‚ç‚¹ï¼‰

åˆ é™¤å¹¶è¿”å›æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹

è¯­æ³•ï¼š

``` js
dom.empty(node)
```

è¿”å›å€¼ï¼š

- æ•°ç»„ï¼Œæ•°ç»„å…ƒç´ æ˜¯ä¸€ä¸ªä¸ªè¢«åˆ é™¤çš„å­èŠ‚ç‚¹

å®ç°ï¼š

``` js
{
  empty(node) {
    const arrChildren = Array.from(dom.children(node))
    let array = [];
    for (let i = 0; i < arrChildren.length; i++) {
      array.push(dom.remove(arrChildren[i]));
    }
    return array;
  }
}
```

> ç”¨ `for` å¾ªç¯éå†å…ƒç´ é›†åˆæœ‰bugå‘€ï¼äºæ˜¯æˆ‘æŠŠä¼ªæ•°ç»„æ•°ç»„åŒ–äº†ï¼-> æˆ–è®¸æ˜¯æµè§ˆå™¨çš„é—®é¢˜ï¼

## â˜…æ”¹


