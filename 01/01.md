### âœï¸ Tangxt â³ 2020-11-27 ğŸ·ï¸ DOM

# 01-DOM å°è£…-å¯¹è±¡é£æ ¼

å¯¹è±¡é£æ ¼ä¹Ÿå«å‘½åç©ºé—´é£æ ¼ï¼Œæˆ‘ä»¬åœ¨ `window` æ——ä¸‹æä¸ªå…¨å±€å±æ€§ `dom` ï¼Œé‚£ä¹ˆ `window.dom` å°±æ˜¯å‘½åç©ºé—´ã€‚

æˆ‘ä»¬å¯¹ `dom` è¿™ä¸ªå¯¹è±¡æ·»åŠ äº†ã€Œå¢åˆ æ”¹æŸ¥ã€åŠŸèƒ½ï¼Œä»¥æ­¤æ¥å®Œæˆå¯¹å…ƒç´ çš„ DOM æ“ä½œï¼æ¯•ç«ŸåŸç”Ÿ DOM API ä½¿ç”¨èµ·æ¥ä¸æ€ä¹ˆæ–¹ä¾¿ï¼

[GitHub æºç åœ°å€](https://github.com/ppambler/dom-lib/commit/659e550c734dba786c243969b4510158998d5259)ã€[æµ‹è¯•åœ°å€](https://ppambler.github.io/dom-lib/dist/)

## â˜…æŸ¥

### <mark>1ï¼‰dom.findï¼ˆè·å–èŠ‚ç‚¹ï¼‰</mark>

#### <mark>1ã€è·å–ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹</mark>

è¯­æ³•ï¼š

``` js
dom.findOne(selector[, container])
```

å‚æ•°ï¼š

* `selector`ï¼šå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªåŒ…å«å•ä¸ªæˆ–å¤šä¸ªåŒ¹é…çš„é€‰æ‹©å™¨çš„å­—ç¬¦ä¸²
* `container`ï¼šèŠ‚ç‚¹å¯¹è±¡ï¼ˆ`document`èŠ‚ç‚¹ or å…ƒç´ èŠ‚ç‚¹ï¼‰ï¼Œå¯é€‰ï¼Œé»˜è®¤å€¼æ˜¯`document`èŠ‚ç‚¹

è¿”å›å€¼ï¼š

* ä¸æŒ‡å®šé€‰æ‹©å™¨æˆ–é€‰æ‹©å™¨ç»„åŒ¹é…çš„ç¬¬ä¸€ä¸ª `Element`ï¼Œå¦‚æœæœªæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œé‚£å°±è¿”å›`null`

å®ç°ï¼š

``` js
{
  findOne(selector, container) {
    return (container || document).querySelector(selector)
  }
}
```

#### <mark>2ã€è·å–å¤šä¸ªå…ƒç´ èŠ‚ç‚¹</mark>

è¯­æ³•ï¼š

``` js
dom.find(selectors[, container])
```

å‚æ•°ï¼š

* `selector`ï¼šå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªåŒ…å«å•ä¸ªæˆ–å¤šä¸ªåŒ¹é…çš„é€‰æ‹©å™¨çš„å­—ç¬¦ä¸²
* `container`ï¼šèŠ‚ç‚¹å¯¹è±¡ï¼ˆ`document`èŠ‚ç‚¹ or å…ƒç´ èŠ‚ç‚¹ï¼‰ï¼Œå¯é€‰ï¼Œé»˜è®¤å€¼æ˜¯`document`èŠ‚ç‚¹

è¿”å›å€¼ï¼š

* ä¸€ä¸ªé™æ€çš„`NodeList`å¯¹è±¡ï¼Œå®ƒæœ‰ç€ä¸æŒ‡å®šé€‰æ‹©å™¨æˆ–é€‰æ‹©å™¨ç»„ç›¸åŒ¹é…çš„å…ƒç´ èŠ‚ç‚¹åˆ—è¡¨ï¼Œå¦‚æœæœªæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œé‚£å°±è¿”å›ä¸€ä¸ª`length`ä¸º`0`çš„`NodeList`å¯¹è±¡ï¼

å®ç°ï¼š

``` js
{
  find(selectors, container) {
    return (container || document).querySelectorAll(selectors)
  }
}
```

ğŸ’¡ï¼š `querySelector` ä¸ `querySelectorAll` çš„åŒºåˆ«ï¼Ÿ

``` html
<ul class="container">
  <li class="list" id="one">åˆ—è¡¨ 1</li>
  <li class="list">åˆ—è¡¨ 2</li>
  <li class="list" id="three">åˆ—è¡¨ 3</li>
</ul>
```

![åŒºåˆ«](assets/img/2020-11-27-18-18-34.png)

ğŸ’¡ï¼šä»€ä¹ˆæ˜¯ã€Œé™æ€çš„ã€ï¼Ÿ

é™æ€ `NodeList` å°±æ˜¯å¯¹åº•å±‚ `document` çš„æ›´æ”¹ä¸ä¼šå½±å“åˆ°è¿”å›çš„è¿™ä¸ª `NodeList` å¯¹è±¡ã€‚æ­¤æ—¶è¿”å›çš„ `NodeList` åªæ˜¯ `querySelectorAll()` æ–¹æ³•è¢«è°ƒç”¨æ—¶çš„**æ–‡æ¡£çŠ¶æ€çš„å¿«ç…§**ã€‚

``` js
var divs = document.querySelectorAll("div");
var i = 0;
while (i < divs.length) {
  document.body.appendChild(document.createElement("div"));
  i++;
}
```

åœ¨è¿™ç§æƒ…å†µä¸‹æ²¡æœ‰æ­»å¾ªç¯ï¼Œ `divs.length` çš„å€¼æ°¸è¿œä¸ä¼šæ”¹å˜ï¼Œä¸ä¼šå› ä¸ºæ–‡æ¡£çŠ¶æ€å˜åŒ–äº†ï¼Œä½¿å¾— `divs.length` ä¹Ÿå‘ç”Ÿå˜åŒ–äº†ã€‚

æ€»ä¹‹ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªã€Œå½¼æ¶ˆæˆ‘é•¿ã€çš„è¿‡ç¨‹

è€ŒåŠ¨æ€çš„ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä½ è·å¾—ä¸œè¥¿æ˜¯ä¼šå˜åŒ–çš„ï¼Œæ¯”å¦‚æ­¤åˆ»ä½ çš„é“¶è¡Œå¡é‡Œæœ‰ 100 å…ƒï¼Œä½†è¿‡å‡ å°æ—¶åï¼Œå®ƒå°±æœ‰ 200 å…ƒäº†ã€‚

â¹ï¼š[é™æ€ NodeList å’Œ åŠ¨æ€ NodeList çš„åŒºåˆ«_å‰ç«¯å­¦ä¹ ä¹‹è·¯ - SegmentFault æ€å¦](https://segmentfault.com/a/1190000008829267)

### <mark>2ï¼‰dom.parentï¼ˆè·å–çˆ¶èŠ‚ç‚¹ï¼‰</mark>

è¯­æ³•ï¼š

``` js
dom.parent(node)
```

å‚æ•°ï¼š

* `node`ï¼šèŠ‚ç‚¹å¯¹è±¡

è¿”å›å€¼ï¼š

* æŒ‡å®šèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹

å®ç°ï¼š

``` js
{
  parent(node) {
    return node.parentNode;
  }
}
```

### <mark>3ï¼‰dom.childrenï¼ˆè·å–å­å…ƒç´ ä»¬ï¼‰</mark>

è¯­æ³•ï¼š

``` js
dom.children(node)
```

å‚æ•°ï¼š

* `node`ï¼šèŠ‚ç‚¹å¯¹è±¡

è¿”å›å€¼ï¼š

* ä¸€ä¸ªåŠ¨æ€çš„ã€æœ‰åºçš„`HTMLCollection`ï¼Œå¦‚æœ`node`æ²¡æœ‰å­å…ƒç´ ï¼Œé‚£å°±è¿”å›`length`ä¸º`0`çš„ç©ºåˆ—è¡¨

å®ç°ï¼š

``` js
{
  children(node) {
    return node.children;
  }
}
```

### <mark>4ï¼‰dom.siblingsï¼ˆè·å–åŒçº§èŠ‚ç‚¹ï¼‰</mark>

è¯­æ³•ï¼š

``` js
dom.siblings(node)
```

è¿”å›å€¼ï¼š

* æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰åŒçº§èŠ‚ç‚¹åˆ—è¡¨ï¼Œè¿”å›çš„å¯¹è±¡æ˜¯ Array

å®ç°ï¼š

``` js
siblings(node) {
  return Array.from(node.parentNode.children).filter((item) => item !== node);
}
```

> å¦‚ä½•æ‹¿åˆ°æ‰€æœ‰çš„å…„å¼Ÿå…ƒç´ èŠ‚ç‚¹ï¼Ÿ-> æ‰¾åˆ°çˆ¸çˆ¸ï¼Œæ‹¿åˆ°çˆ¸çˆ¸çš„æ‰€æœ‰å­å…ƒç´ èŠ‚ç‚¹ä»¬ï¼Œæ•°ç»„åŒ–ï¼Œè¿‡æ»¤æ‰æŒ‡å®šèŠ‚ç‚¹

### <mark>5ï¼‰dom.previousï¼ˆè·å–ä¸Šä¸€ä¸ªç›¸é‚»èŠ‚ç‚¹ï¼‰</mark>

è¯­æ³•ï¼š

``` js
dom.previous(node)
```

å®ç°ï¼š

``` js
{
  previous(node) {
    let p = node.previousSibling;
    while (p && p.nodeType === 3) {
      p = p.previousSibling;
    }
    return p;
  }
}
```

> å…ƒç´ èŠ‚ç‚¹çš„ `nodeType` ä¸º `1` ï¼Œè€Œæ–‡æœ¬èŠ‚ç‚¹åˆ™æ˜¯ `3` ã€‚å¦‚æœæŒ‡å®šèŠ‚ç‚¹çš„å‰ä»»èŠ‚ç‚¹æ˜¯æ–‡æœ¬èŠ‚ç‚¹ï¼Œé‚£å°±ç»§ç»­æŸ¥æ‰¾â€¦â€¦

ğŸ’¡ï¼š `Node.previousSibling` ï¼Ÿ

åªè¯»å±æ€§ï¼Œè¿”å›å…¶çˆ¶èŠ‚ç‚¹çš„ `childNodes` åˆ—è¡¨ä¸­çš„æ‰€æŒ‡å®šèŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæŒ‡å®šçš„èŠ‚ç‚¹æ˜¯è¯¥åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™è¿”å› `null`

### <mark>6ï¼‰dom.nextï¼ˆè·å–åä¸€ä¸ªåŒçº§èŠ‚ç‚¹ï¼‰</mark>

è¯­æ³•ï¼š

``` js
dom.next(node)
```

å®ç°ï¼š

``` js
{
  next(node) {
    let n = node.nextSibling;
    while (n && n.nodeType === 3) {
      n = n.nextSibling;
    }
    return n;
  }
}
```

### <mark>7ï¼‰dom.travelï¼ˆéå†èŠ‚ç‚¹ï¼‰</mark>

è¯­æ³•ï¼š

``` js
dom.travel(nodeList, callback)
```

> `callback` çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å½“å‰å…ƒç´ èŠ‚ç‚¹

å‚æ•°ï¼š

* `nodeList`ï¼šè¢«éå†çš„èŠ‚ç‚¹åˆ—è¡¨æˆ–å…ƒç´ é›†åˆ
* `callback`ï¼šéå†å¾—åˆ°ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹å¯¹è±¡ï¼Œå°±ä¼šæ‰§è¡Œä¸€æ¬¡`callback`

è¿”å›å€¼ï¼š

* `undefined`

å®ç°ï¼š

``` js
{
  travel(nodeList, callback) {
    for (let i = 0; i < nodeList.length; i++) {
      callback.call(null, nodeList[i]);
    }
  }
}
```

### <mark>8ï¼‰dom.indexï¼ˆè·å–èŠ‚ç‚¹ç´¢å¼•ï¼‰</mark>

è¯­æ³•ï¼š

``` js
dom.index(node)
```

è¿”å›å€¼ï¼š

* æŒ‡å®šèŠ‚ç‚¹åœ¨å…¶çˆ¶èŠ‚ç‚¹ä¸­çš„ç´¢å¼•å€¼

å®ç°ï¼š

``` js
{
  index(node) {
    const nodeList = dom.children(dom.parent(node));
    for (let i = 0; i < nodeList.length; i++) {
      if (nodeList[i] === node) {
        return i;
      }
    }
  }
}
```

## â˜…å¢

### <mark>1ï¼‰dom.createï¼ˆåˆ›å»ºèŠ‚ç‚¹ï¼‰</mark>

è¯­æ³•ï¼š

``` js
dom.create(string)
```

å‚æ•°ï¼š

* `string`ï¼šHTML ä»£ç ç‰‡æ®µå­—ç¬¦ä¸²ï¼Œå¦‚`'<p>æˆ‘æ˜¯æ®µè½</p>'`ï¼Œè¯·ä¿è¯è¯¥ç‰‡æ®µåªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹

è¿”å›å€¼ï¼š

* ä¸€ä¸ªå…ƒç´ èŠ‚ç‚¹ï¼ˆæ–‡æ¡£ç‰‡æ®µèŠ‚ç‚¹çš„å…ƒç´ èŠ‚ç‚¹åŒ–ï¼‰

å®ç°ï¼š

``` js
{
  create(string) {
    const template = document.createElement("template");
    template.innerHTML = string.trim();
    return template.content.firstChild;
  }
}
```

ğŸ’¡ï¼š `template` å…ƒç´ ï¼Ÿ

HTML `<template>` å…ƒç´ ä»£è¡¨æ ‡è®°ä¸­çš„ä¸€ä¸ªæ¨¡æ¿ï¼Œå®ƒåŒ…å«â€æ¨¡æ¿å†…å®¹â€ï¼›æœ¬è´¨ä¸Šæ˜¯ä¸€å¤§å—çš„æƒ°æ€§å¯å¤åˆ¶ DOMã€‚ å¯ä»¥æŠŠæ¨¡æ¿æƒ³è±¡æˆä¸€ä¸ªè„šæ‰‹æ¶çš„é›¶ä»¶ï¼ˆèºä¸é’‰ï¼‰ï¼Œåœ¨åº”ç”¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä½ éƒ½å¯ä»¥ä½¿ç”¨ï¼ˆå’Œé‡ç”¨ï¼‰å®ƒ

ä½ åœ¨å†™äº†ä¸€ä¸ª `template` å…ƒç´ ï¼Œé¡µé¢å¹¶ä¸ä¼šæ¸²æŸ“è¿™ä¸ªæ ‡ç­¾ï¼š

![template](assets/img/2020-11-27-23-55-10.png)

> è¯¥å…ƒç´ èŠ‚ç‚¹åº”è¯¥æ˜¯å‚ä¸äº† DOM æ ‘çš„æ„å»º

æµ‹è¯•ä¾‹å­ï¼š

``` html
<template id="tem">
  <div id="div1">æˆ‘æ˜¯ template</div>
  <div>æˆ‘æ˜¯ template</div>
</template>
<script>
  let o = document.getElementById("tem");
  console.log(o.content.nodeName); //#document-fragment
  console.log(o.content.querySelectorAll("div")); //NodeList(2) [div#div1, div]ã€‚å¾—åˆ°ä¸€ä¸ªç±»æ•°ç»„
  console.log(o.content.getElementById("div1")); //<div id="div1">æˆ‘æ˜¯ template</div>
  console.log(o.innerHTML); //'<div id="div1">æˆ‘æ˜¯ template</div><div>æˆ‘æ˜¯ template</div>'
</script>
```

### <mark>2ï¼‰dom.beforeï¼ˆå‘å‰æ’å…¥èŠ‚ç‚¹ï¼‰</mark>

è¯­æ³•ï¼š

``` js
dom.before(node, referenceNode)
```

å‚æ•°ï¼š

* `node`ï¼šæŒ‡å®šè¦æ’å…¥çš„èŠ‚ç‚¹
* `referenceNode`ï¼šå‚è€ƒèŠ‚ç‚¹å¯¹è±¡ï¼Œå¯ç®€å•ç†è§£æˆå¤„åœ¨åæ ‡ä¸º 0 çš„èŠ‚ç‚¹ï¼ˆä¸€ç»´åæ ‡ç³»ï¼‰

å®ç°ï¼š

``` js
{
  before(node, referenceNode) {
    dom.parent(referenceNode).insertBefore(node, referenceNode);
  }
}
```

### <mark>3ï¼‰dom.afterï¼ˆå‘åæ’å…¥èŠ‚ç‚¹ï¼‰</mark>

è¯­æ³•ï¼š

``` js
dom.after(node, referenceNode)
```

å®ç°ï¼š

``` js
{
  after(node, referenceNode) {
    dom.parent(referenceNode).insertBefore(node, dom.next(referenceNode));
  }
}
```

### <mark>4ï¼‰dom.appendï¼ˆæ’å…¥å­èŠ‚ç‚¹ï¼‰</mark>

æ‰¾åˆ°æŸä¸ªèŠ‚ç‚¹ï¼ŒæŠŠæŒ‡å®šèŠ‚ç‚¹ä½œä¸ºå®ƒçš„å­èŠ‚ç‚¹æ’å…¥å…¶ä¸­

è¯­æ³•ï¼š

``` js
dom.append(node, parentNode)
```

å®ç°ï¼š

``` js
{
  append(node, parentNode) {
    parentNode.appendChild(node);
  }
}
```

### <mark>5ï¼‰dom.wrapï¼ˆæ’å…¥çˆ¶èŠ‚ç‚¹ï¼‰</mark>

æ‰¾åˆ°æŸä¸ªèŠ‚ç‚¹ï¼ŒæŒ‡å®šèŠ‚ç‚¹è®¤å®ƒä¸ºå¹²å„¿å­

è¯­æ³•ï¼š

``` js
dom.wrap(node, childNode)
```

å®ç°ï¼š

``` js
{
  wrap(node, childNode) {
    dom.before(node, childNode);
    dom.append(childNode, node);
  }
}
```

> æˆ‘å½“ä½ æ˜¯ä½ å…„å¼Ÿï¼Œä½ å±…ç„¶æƒ³è®©æˆ‘å«ä½ çˆ¸çˆ¸ï¼Ÿ

## â˜…åˆ 

### <mark>1ï¼‰dom.removeï¼ˆåˆ é™¤èŠ‚ç‚¹ï¼‰</mark>

åˆ é™¤æŒ‡å®šèŠ‚ç‚¹ï¼Œå¹¶è¿”å›è¢«åˆ é™¤çš„æŒ‡å®šèŠ‚ç‚¹

è¯­æ³•ï¼š

``` js
dom.remove(node)
```

å®ç°ï¼š

``` js
{
  remove(node) {
    node.remove();
    return node;
  }
}
```

### <mark>2ï¼‰dom.emptyï¼ˆæ¸…ç©ºå­èŠ‚ç‚¹ï¼‰</mark>

åˆ é™¤å¹¶è¿”å›æŒ‡å®šèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹

è¯­æ³•ï¼š

``` js
dom.empty(node)
```

è¿”å›å€¼ï¼š

* æ•°ç»„ï¼Œæ•°ç»„å…ƒç´ æ˜¯ä¸€ä¸ªä¸ªè¢«åˆ é™¤çš„å­èŠ‚ç‚¹

å®ç°ï¼š

``` js
{
  empty(node) {
    const arrChildren = Array.from(dom.children(node))
    let array = [];
    for (let i = 0; i < arrChildren.length; i++) {
      array.push(dom.remove(arrChildren[i]));
    }
    return array;
  }
}
```

> ç”¨ `for` å¾ªç¯éå†å…ƒç´ é›†åˆæœ‰ bug å‘€ï¼äºæ˜¯æˆ‘æŠŠä¼ªæ•°ç»„æ•°ç»„åŒ–äº†ï¼-> æˆ–è®¸æ˜¯æµè§ˆå™¨çš„é—®é¢˜ï¼

## â˜…æ”¹

### <mark>1ï¼‰dom.attributeï¼ˆè¯»å†™ç‰¹æ€§ï¼‰</mark>

è¿”å›æŒ‡å®šèŠ‚ç‚¹æŸä¸ªç‰¹æ€§çš„å€¼æˆ–è€…ä¿®æ”¹æŒ‡å®šèŠ‚ç‚¹æŸä¸ªç‰¹æ€§çš„å€¼ï¼

è¯­æ³•ï¼š

``` js
let attribute = dom.attribute(node, name)
dom.attribute(node, name, value)
```

> èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œè¡¨ç¤ºæœ‰è¿”å›å€¼ï¼Œä¸ç„¶ï¼Œåˆ™æ˜¯æ²¡æœ‰è¿”å›å€¼ï¼Œä¹Ÿå°±æ˜¯è¿”å›é»˜è®¤çš„ `undefined`

å‚æ•°ï¼š

* `node`ï¼šå…ƒç´ èŠ‚ç‚¹å¯¹è±¡ï¼Œè¢«æŒ‡å®šçš„èŠ‚ç‚¹
* `name`ï¼šå­—ç¬¦ä¸²ï¼Œç‰¹æ€§åç§°
* `value`ï¼šå­—ç¬¦ä¸²ï¼Œèµ‹äºˆç‰¹æ€§æ–°çš„å€¼

å®ç°ï¼š

``` js
{
  attribute(node, name, value) {
    // é‡è½½
    if (arguments.length === 2) {
      return node.getAttribute(name);
    } else if (arguments.length === 3) {
      node.setAttribute(name, value);
    }
  }
}
```

ğŸ’¡ï¼šä½•ä¸ºã€Œé‡è½½ã€ï¼Ÿ

å½“ä¼ å…¥ä¸¤ä¸ªå‚æ•°æ—¶ï¼Œè¯»å–æŒ‡å®šèŠ‚ç‚¹çš„æŒ‡å®šç‰¹æ€§å€¼ï¼›å½“ä¼ å…¥ä¸‰ä¸ªå‚æ•°æ—¶ï¼Œä¿®æ”¹æŒ‡å®šèŠ‚ç‚¹çš„æŒ‡å®šç‰¹æ€§å€¼

### <mark>2ï¼‰dom.styleï¼ˆè¯»å†™ style å±æ€§ï¼‰</mark>

æ‹¿åˆ°æŒ‡å®šèŠ‚ç‚¹çš„æŸä¸ªæ ·å¼å±æ€§å€¼æˆ–è€…ä¿®æ”¹æŒ‡å®šèŠ‚ç‚¹çš„æŸä¸ªæ ·å¼å±æ€§å€¼

è¯­æ³•ï¼š

``` js
let value = dom.style(node, name)
dom.style(node, name, value)
```

å‚æ•°ï¼š

* `node`ï¼šå…ƒç´ èŠ‚ç‚¹å¯¹è±¡ï¼ŒæŒ‡å®šè¢«æ“ä½œçš„èŠ‚ç‚¹
* `name`ï¼šå­—ç¬¦ä¸² æˆ– å¯¹è±¡
  + å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œé‚£å°±æ˜¯æ ·å¼å±æ€§åç§°ï¼Œè€Œæˆ‘ä»¬å°±æ˜¯åœ¨å–è¯¥æŒ‡å®šèŠ‚ç‚¹çš„å±æ€§å€¼ï¼Œ
  + å¦‚æœæ˜¯å¯¹è±¡ï¼Œå…¶æ ¼å¼åˆ™æ˜¯è¿™æ ·çš„ï¼š`{color:'red','fontSize':'60px'}`ï¼Œè€Œæˆ‘ä»¬å°±æ˜¯åœ¨æ‰¹é‡ä¿®æ”¹æ ·å¼å±æ€§çš„å€¼
* `value`ï¼šä¸`name`ä¸ºå­—ç¬¦ä¸²å€¼é…åˆï¼Œç»™å•ä¸ªæ ·å¼å±æ€§æ–°å€¼

å®ç°ï¼š

``` js
{
  style(node, name, value) {
    // é‡è½½
    if (arguments.length === 2) {
      if (typeof name === "string") {
        return node.style[name];
      } else if (name instanceof Object) {
        for (let key in name) {
          node.style[key] = name[key];
        }
      }
    } else if (arguments.length === 3) {
      node.style[name] = value;
    }
  }
}
```

> é‡è½½ï¼šå½“ä¼ å…¥ä¸¤ä¸ªå‚æ•°æ—¶ï¼Œè¯»å–**æŒ‡å®šèŠ‚ç‚¹**çš„**æŒ‡å®šç‰¹æ€§**å€¼ï¼›å½“ä¼ å…¥ä¸‰ä¸ªå‚æ•°æ—¶ï¼Œä¿®æ”¹æŒ‡å®šèŠ‚ç‚¹çš„æŒ‡å®šç‰¹æ€§å€¼

ğŸ’¡ï¼š `window.getComputedStyle()` vs `style` ï¼Ÿ

ç›¸åŒç‚¹ï¼š

`getComputedStyle` å’Œ `element.style` çš„ç›¸åŒç‚¹å°±æ˜¯äºŒè€…è¿”å›çš„éƒ½æ˜¯ `CSSStyleDeclaration` å¯¹è±¡ï¼Œå–ç›¸åº”å±æ€§å€¼å¾—æ—¶å€™éƒ½æ˜¯é‡‡ç”¨çš„ CSS é©¼å³°å¼å†™æ³•ï¼Œå‡éœ€è¦æ³¨æ„ `float` å±æ€§

ä¸åŒç‚¹ï¼š

* `element.style` è¯»å–çš„åªæ˜¯å…ƒç´ çš„**è¡Œå†…æ ·å¼**ï¼Œå³å†™åœ¨å…ƒç´ çš„ `style` å±æ€§ä¸Šçš„æ ·å¼ï¼›è€Œ `getComputedStyle` è¯»å–çš„æ ·å¼æ˜¯**æœ€ç»ˆæ ·å¼**ï¼ŒåŒ…æ‹¬äº†**è¡Œå†…æ ·å¼ã€å†…éƒ¨æ ·å¼å’Œå¤–éƒ¨æ ·å¼**ã€‚
* `element.style` æ—¢**æ”¯æŒè¯»ä¹Ÿæ”¯æŒå†™**ï¼Œæˆ‘ä»¬é€šè¿‡ `element.style` å³å¯æ”¹å†™å…ƒç´ çš„æ ·å¼ã€‚è€Œ `getComputedStyle` **ä»…æ”¯æŒè¯»å¹¶ä¸æ”¯æŒå†™å…¥**ã€‚

**æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ `getComputedStyle` è¯»å–æ ·å¼ï¼Œé€šè¿‡ `element.style` ä¿®æ”¹æ ·å¼**

### <mark>3ï¼‰dom.classï¼ˆä¿®æ”¹ class å±æ€§ï¼‰</mark>

`class` å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæ——ä¸‹æœ‰è¿™äº›æ–¹æ³•ï¼š

* `dom.class.has`ï¼šåˆ¤æ–­æŒ‡å®šèŠ‚ç‚¹çš„`class`å±æ€§æ˜¯å¦åŒ…å«ç›¸åº”çš„ class å­—ç¬¦ä¸²åç§°ï¼Œè¿”å›å€¼ä¸ºå¸ƒå°”å€¼
* `dom.class.add`ï¼šä¸ºæŒ‡å®šèŠ‚ç‚¹çš„`class`å±æ€§è¿½åŠ ä¸€ä¸ª `class` åç§°
* `dom.class.remove`ï¼šä¸ºæŒ‡å®šèŠ‚ç‚¹çš„`class`å±æ€§ç§»é™¤ä¸€ä¸ª `class` åç§°

è¯­æ³•ï¼š

``` js
let flag = dom.class.has(node, className)
dom.class.add(node, className)
dom.class.remove(node, className)
```

å®ç°ï¼š

``` js
{
  class: {
    has(node, className) {
      return node.classList.contains(className);
    },
    add(node, className) {
      node.classList.add(className);
    },
    remove(node, className) {
      node.classList.remove(className);
    },
  }
}
```

### <mark>4ï¼‰dom.textï¼ˆè¯»å†™æ–‡æœ¬å†…å®¹ï¼‰</mark>

è¿”å›æŒ‡å®šèŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ or ä¿®æ”¹æŒ‡å®šèŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹

è¯­æ³•ï¼š

``` js
let text = dom.text(node)
dom.text(node, string)
```

å®ç°ï¼š

``` js
{
  text(node, string) {
    // é‡è½½
    if (arguments.length === 1) {
      // é€‚é…
      return document.all ? node.innerText : node.textContent;
    } else if (arguments.length === 2) {
      document.all ? (node.innerText = string) : (node.textContent = string);
    }
  }
}
```

> é‡è½½ï¼šå½“ä¼ å…¥ä¸€ä¸ªå‚æ•°æ—¶ï¼Œè¯»å–æŒ‡å®šèŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ï¼›å½“ä¼ å…¥ä¸¤ä¸ªå‚æ•°æ—¶ï¼Œä¿®æ”¹æŒ‡å®šèŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹
>  
> é€‚é…ä½ç‰ˆæœ¬æµè§ˆå™¨ï¼šåŸºäº `document.all` å®ç°ï¼Œå…¼å®¹ IE æµè§ˆå™¨

ğŸ’¡ï¼š `innerText` vs `textContent` ï¼Ÿ

å‰è€… IE6 å°±å¼€å§‹æ”¯æŒäº†ï¼Œè€Œåè€…åˆ™åˆ° IE9 æ‰å¼€å§‹æ”¯æŒ

å®ƒä»¬çš„ä¸åŒç‚¹ï¼š

* è°ƒç”¨å¯¹è±¡ä¸åŒï¼š
  + `innerText`ï¼šåªæœ‰ HTML å…ƒç´ æ‰å¯ä»¥è°ƒç”¨ï¼Œå¦‚`HTMLElement.innerText`
  + `textContent`ï¼šä»»æ„ Node èŠ‚ç‚¹éƒ½å¯ä»¥è°ƒç”¨ï¼Œå¦‚`Node.textContent`
* å€¼è·å–è§„åˆ™ä¸åŒï¼š
  + `innerText`ï¼š
    - ç©ºæ ¼ï¼šå­èŠ‚ç‚¹ä»¬å¦‚æœæ˜¯è¿™æ ·çš„ç»„åˆã€Œæ–‡æœ¬èŠ‚ç‚¹+å—çº§å…ƒç´ ï¼ˆ`display`åå¤©å˜åŒ–ä¸º`block`ä¹Ÿç®—ï¼‰ã€ï¼Œé‚£ä¹ˆåœ¨è·å–æ–‡æœ¬å†…å®¹æ—¶ï¼Œå—çº§å…ƒç´ çš„å†…å®¹å‰è¾¹ä¼šæœ‰ä¸ªç©ºæ ¼ï¼Œè€Œè¿™ä¸ªç©ºæ ¼çš„å®è´¨å°±æ˜¯æ¢è¡Œç¬¦ã€‚
    - å…ƒç´ éšè—äº†ï¼šä¸ä¼šè·å–è¢«éšè—çš„å†…å®¹
    - æ€§èƒ½ï¼šè¯¥å±æ€§è·å–å€¼æ—¶ä¼šè€ƒè™‘ CSS æ ·å¼ï¼Œæ‰€ä»¥åœ¨è¯»å–`innerText`çš„å€¼ä¼šè§¦å‘å›æµä»¥ç¡®ä¿è®¡ç®—å‡ºçš„æ ·å¼æ˜¯æœ€æ–°çš„ï¼Œè€Œå›æµåœ¨è®¡ç®—ä¸Š**è€—æ€§èƒ½**ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é¿å…å›æµ
    - IE 11 ä¸‹çš„`innerText`çš„è¡¨ç°å’Œè§„èŒƒæ˜¯ä¸ç¬¦çš„ï¼Œå³å®ƒä¹Ÿæ²¡æœ‰ç©ºæ ¼ã€ä¹Ÿä¼šè·å–éšè—å…ƒç´ çš„å†…å®¹ï¼Œä¸è¿‡ï¼Œåœ¨ IE11 åŠä»¥ä¸‹ï¼Œä¸`textContent`ä¸åŒçš„æ˜¯ï¼Œä½ å¯¹`xxx.innerText`èµ‹å€¼äº†ï¼Œé‚£ä¹ˆ`xxx`å°±å’©æœ‰å­èŠ‚ç‚¹äº†ï¼Œå¹¶ä¸”æ°¸ä¹…é”€æ¯æ‰€æœ‰å­æ–‡æœ¬èŠ‚ç‚¹ã€‚
  + `textContent`ï¼š
    - ç©ºæ ¼ï¼šå—çº§å…ƒç´ å‰è¾¹ä¸ä¼šæœ‰ç©ºæ ¼ã€‚
    - å…ƒç´ å½±è—äº†ï¼šä¼šè·å–è¢«éšè—çš„å†…å®¹ï¼Œå³`display:none`äº†çš„å†…å®¹ä¹Ÿä¼šè·å–
    - æ€§èƒ½ï¼šåªæ˜¯å•çº¯è¯»å–æ–‡æœ¬å†…å®¹ï¼Œ**æ€§èƒ½æ›´é«˜**

æ€»ä¹‹ï¼Œæ¨èä½¿ç”¨ `textContent` è·å–æ–‡æœ¬å†…å®¹ï¼Œæ¯•ç«Ÿ `innerText` å­˜åœ¨è¯¸å¤šç‰¹åˆ«çš„ç‰¹æ€§ã€ä»¥åŠå…¼å®¹æ€§å·®å¼‚ï¼Œä»¥åŠæ€§èƒ½æ–¹é¢é—®é¢˜ï¼Œæ›´ä½•å†µæˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ï¼Œå¤§å¤šä¸ä¼šå»å…¼å®¹ IEã€‚

> æˆ‘æ²¡æœ‰æƒ³åˆ°ï¼Œè·å–çš„æ–‡æœ¬å†…å®¹å±…ç„¶æ˜¯åŒ…æ‹¬åä»£æ–‡æœ¬å†…å®¹çš„ï¼Œæˆ‘ä¸€ç›´ä»¥ä¸ºåªæ˜¯ç›´æ¥çš„å­èŠ‚ç‚¹çš„æ–‡æœ¬å†…å®¹ï¼Œä¸è¿‡ï¼Œæ–‡æœ¬èŠ‚ç‚¹å…¶å®æ˜¯è¢«éšå¼çš„ `span` åŒ…è£¹ä½çš„ï¼Œæ‰€ä»¥è¿™å€’æ˜¯æ²¡å•¥å¥‡æ€ªåœ°æ–¹ï¼

### <mark>5ï¼‰dom.htmlï¼ˆè¯»å†™ HTML å†…å®¹ï¼‰</mark>

è¿”å›æŒ‡å®šèŠ‚ç‚¹çš„ HTML å†…å®¹ or ä¿®æ”¹æŒ‡å®šèŠ‚ç‚¹çš„çš„ HTML å†…å®¹

è¯­æ³•ï¼š

``` js
let content = dom.html(node)
dom.html(node, htmlString)
```

å®ç°ï¼š

``` js
{
  html(node, string) {
    // é‡è½½
    if (arguments.length === 1) {
      return node.innerHTML;
    } else if (arguments.length === 2) {
      node.innerHTML = string;
    }
  }
}
```

> é‡è½½ï¼šå½“ä¼ å…¥ä¸€ä¸ªå‚æ•°æ—¶ï¼Œè¯»å–æŒ‡å®šèŠ‚ç‚¹çš„ HTML å†…å®¹ï¼›å½“ä¼ å…¥ä¸¤ä¸ªå‚æ•°æ—¶ï¼Œä¿®æ”¹æŒ‡å®šèŠ‚ç‚¹çš„ HTML å†…å®¹

### <mark>6ï¼‰dom.on / dom.offï¼ˆäº‹ä»¶ç›‘å¬ï¼‰</mark>

è®¾ç½®/åˆ é™¤ æŒ‡å®šèŠ‚ç‚¹çš„ç›‘å¬äº‹ä»¶

è¯­æ³•ï¼š

``` js
dom.on(node, eventType, listener[, useCapture])
dom.off(node, eventType, listener[, useCapture])
```

> `useCapture`é»˜è®¤å€¼æ˜¯`false`ï¼Œè¡¨ç¤ºç”¨å†’æ³¡å§¿åŠ¿ã€‚æ³¨æ„ï¼Œå¦‚æœä½ ç”¨äº†`off`ï¼Œé‚£ä¹ˆè¿™ä¸ª`listener`çš„å®å‚å¾—æ˜¯å‡½æ•°åå“ˆï¼-> ä¸€ä¸ª`click`äº‹ä»¶ï¼Œæ˜¯å¯ä»¥ç»‘å®šå¤šä¸ª`callback`ï¼Œå½“ä½ è¦ç§»é™¤æŸä¸ª`callback`çš„æ—¶å€™ï¼Œä½ å¾—çŸ¥é“è¿™ä¸ª`callback`å«ä»€ä¹ˆæ‰è¡Œï¼

å®ç°ï¼š

``` js
{
  on(node, eventType, listener, useCapture = false) {
      node.addEventListener(eventType, listener, useCapture);
    },
    off(node, eventType, listener, useCapture = false) {
      node.removeEventListener(eventType, listener, useCapture);
    }
}
```

## â˜…äº†è§£æ›´å¤š

â¹ï¼š[DOM æ¦‚è¿° - Web API æ¥å£å‚è€ƒ - MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/Document_Object_Model/Introduction#Core_Interfaces_in_the_DOM)

â¹ï¼š[Element - Web API æ¥å£å‚è€ƒ - MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/Element)

â¹ï¼š[HTML æ–°çš„ template æ ‡ç­¾ - åˆå¿ƒ](https://zhyihui.github.io/2017/04/12/html-template/)

â¹ï¼š[ã€è½¬è½½ã€‘HTML çš„æ–°æ ‡ç­¾ template_Web Components æ•™ç¨‹_w3cplus](https://www.w3cplus.com/web-components/html-new-template-tag.html)

â¹ï¼š[å…³äº template æ ‡ç­¾ç”¨æ³•æ€»ç»“ï¼ˆå« vue ä¸­çš„ç”¨æ³•æ€»ç»“ï¼‰_æœ€åˆçš„æ¢¦æƒ³-CSDN åšå®¢_template](https://blog.csdn.net/u010510187/article/details/100356624)

â¹ï¼š[Window getComputedStyle() æ–¹æ³• - èœé¸Ÿæ•™ç¨‹](https://www.runoob.com/jsref/jsref-getcomputedstyle.html)

â¹ï¼š[å° tips: JS DOM innerText å’Œ textContent çš„åŒºåˆ« Â«  å¼ é‘«æ—­-é‘«ç©ºé—´-é‘«ç”Ÿæ´»](https://www.zhangxinxu.com/wordpress/2019/09/js-dom-innertext-textcontent/)