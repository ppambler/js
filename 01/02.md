### âœï¸ Tangxt â³ 2020-11-29 ğŸ·ï¸ DOM

# 02-DOM å°è£…-é“¾å¼é£æ ¼

## â˜…Q&A

ğŸ’¡ï¼šä¸ºä»€ä¹ˆè¦ç”¨é“¾å¼å§¿åŠ¿å°è£…ä¸€ä¸ª DOM åº“ï¼Ÿ

å› ä¸ºæˆ‘æƒ³è¿›ä¸€æ­¥ç†è§£ jQuery çš„è®¾è®¡æ€æƒ³

ğŸ’¡ï¼šé“¾å¼é£æ ¼æ˜¯ä»€ä¹ˆï¼Ÿ

é“¾å¼é£æ ¼ä¹Ÿç§°ä½œ jQuery é£æ ¼ï¼Œä¸å¯¹è±¡é£æ ¼ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬å…¨å±€å˜é‡ `jQuery` æ˜¯ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨ `jQuery` å‡½æ•°çš„åŸå‹ä¸Šï¼Œä¹Ÿå°±æ˜¯ `prototype` æ——ä¸‹ï¼Œæ·»åŠ äº†å¯¹å…ƒç´ **å¢åˆ æ”¹æŸ¥**çš„åŠŸèƒ½ï¼

ğŸ’¡ï¼šä¸ºä»€ä¹ˆç”¨ `$` ä½œä¸º `jQuery` çš„åˆ«åï¼Ÿ

å› ä¸ºå®ƒå¤ŸçŸ­å‘€ï¼

ğŸ’¡ï¼šå¦‚ä½•å®ç°é“¾å¼æ“ä½œï¼Ÿ

ä¸ºäº†å®ç°é“¾å¼æ“ä½œï¼Œåœ¨ä½¿ç”¨ `jQuery("é€‰æ‹©å™¨")` æˆ– `$("é€‰æ‹©å™¨")` é€‰æ‹©é¡µé¢å…ƒç´ æ—¶ï¼Œåº”å½“è¿”å›ä¸€ä¸ªå¯æ“ä½œå¯¹åº”å…ƒç´ çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯å…ƒç´ æœ¬èº«ã€‚æˆ‘ä»¬ç§°è¿™ä¸ªå¯¹è±¡ä¸ºç”± jQuery å‡½æ•°æ„é€ çš„å¯¹è±¡ï¼Œç®€ç§°ä¸º **jQuery å¯¹è±¡**ã€‚

åœ¨ jQuery å¯¹è±¡ä¸­æ·»åŠ  `print` å±æ€§ï¼Œå±æ€§å€¼ä¸ºä¸€ä¸ªç”¨äºæ‰“å°å‡ºé€‰æ‹©å…ƒç´ çš„å‡½æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼ä¸º `this` ï¼ŒæŒ‡å‘è°ƒç”¨å®ƒçš„å¯¹è±¡ï¼Œå³ä½œä¸º jQuery å‡½æ•°è¿”å›å€¼çš„ jQuery å¯¹è±¡ã€‚å‡½æ•°ä¸é€‰æ‹©çš„å…ƒç´ æ„æˆé—­åŒ…ç»“æ„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»§ç»­å¯¹å…ƒç´ è¿›è¡Œæ“ä½œï¼Œä»è€Œå½¢æˆé“¾å¼é£æ ¼

``` js
window.$ = window.jQuery = function(selectors) {
  let elements = document.querySelectorAll(selectors)
  return {
    print() {
      console.log(elements)
      return this
    }
  }
}

// é€‰æ‹© class å±æ€§ä¸º list çš„æ‰€æœ‰å…ƒç´ å¹¶å°†å®ƒä»¬æ‰“å°å‡ºæ¥
$(".list").print()
```

ğŸ’¡ï¼šå†…å­˜ä¼˜åŒ–å¤„ç†ï¼Ÿ

æ¯æ¬¡è°ƒç”¨ jQuery å¯¹è±¡ä¸­çš„å‡½æ•°éƒ½ä¼š**æ–°å ç”¨ä¸€å—åœ°å€**ï¼Œä»è€Œå¯¼è‡´å†…å­˜æµªè´¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ï¼š

1. æŠŠ jQuery å¯¹è±¡çš„å…±æœ‰å±æ€§ï¼ˆå‡½æ•°ï¼‰å…¨éƒ¨æ”¾åœ¨ `jQuery.prototype` ä¸Š -> å¯¹å…¶ä½¿ç”¨åˆ«å `jQuery.fn = jQuery.prototype` -> å°† jQuery å¯¹è±¡çš„åŸå‹æŒ‡å‘ `jQuery.fn`ï¼ˆè¿™ä¸€æ­¥çœŸå¾—æœ‰å¿…è¦å—ï¼Ÿ`Object.create(jQuery.fn)`ï¼Ÿï¼‰ -> ä½¿ç”¨ `constructor` è®¾ç½® jQuery å¯¹è±¡çš„æ„é€ å‡½æ•° `jQuery`

2. ä½¿ç”¨ `Object.assign` ä¸º jQuery å¯¹è±¡æ·»åŠ å¤šä¸ªå±æ€§

æˆ‘ä»¬å†™çš„ API éƒ½åœ¨ jQuery å¯¹è±¡çš„åŸå‹å¯¹è±¡ä¸Šï¼Œä¹Ÿå°±æ˜¯åœ¨ `jQuery.prototype` æ——ä¸‹ï¼

## â˜…æŸ¥

1ï¼‰$(selectors)ï¼ˆé€‰æ‹©å…ƒç´ ï¼‰

æ ¹æ®æŒ‡å®šçš„ CSS é€‰æ‹©å™¨é€‰æ‹©æ‰€æœ‰å…ƒç´ ï¼Œè¿”å› jQuery å¯¹è±¡ã€‚

è¯­æ³•ï¼š

``` js
const $api = $(selectors)
```

å‚æ•°ï¼š

* `selectors`ï¼šå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªåŒ…å«å•ä¸ªæˆ–å¤šä¸ªåŒ¹é…çš„é€‰æ‹©å™¨çš„å­—ç¬¦ä¸²

å®ç°ï¼š

``` js
// åˆ«å
window.$ = window.jQuery = function(selectorsOrArrayOrTemplate) {
  let elements;
  // é‡è½½
  if (typeof selectorsOrArrayOrTemplate === "string") {
    if (selectorsOrArrayOrTemplate[0] === "<") {
      elements = [create(selectorsOrArrayOrTemplate)];
    } else {
      elements = document.querySelectorAll(selectorsOrArrayOrTemplate);
    }
  } else if (selectorsOrArrayOrTemplate instanceof Array) {
    elements = selectorsOrArrayOrTemplate;
  }

  function create(string) {
    const template = document.createElement("template");
    template.innerHTML = string.trim();
    return template.content.firstChild;
  }
  // jQuery å¯¹è±¡çš„å…±æœ‰å±æ€§
  const api = Object.create(jQuery.prototype);
  Object.assign(api, {
    elements: elements,
    oldApi: selectorsOrArrayOrTemplate.oldApi,
    jquery: true,
  });
  // é—­åŒ…
  return api;
};
```

> `oldApi` æ˜¯æ—§çš„ jQuery å¯¹è±¡ï¼Œæ¯æ¬¡ä½ è°ƒç”¨ APIï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ jQuery å¯¹è±¡ï¼

ä¸€ä¸ªç–‘é—®ï¼š`elements`è¿™ä¸ªå±æ€§çš„ç±»å‹æ˜¯ä¸æ˜¯åªæ˜¯æ•°ç»„ç±»å‹æ¯”è¾ƒå¥½ï¼Ÿ

2ï¼‰.each(fn)ï¼ˆéå†å…ƒç´ ï¼‰

éå†å…ƒç´ åˆ—è¡¨ï¼Œå¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€æ¬¡æŒ‡å®šçš„å‡½æ•°ï¼Œè¿”å› jQuery å¯¹è±¡ã€‚

è¯­æ³•ï¼š

``` js
const $api = $(selectors).each(fn(element, index))
```

å®ç°ï¼š

``` js
{
  each(fn) {
    for (let index = 0; index < this.elements.length; index++) {
      const element = this.elements[index];
      fn.call(this, element, index);
    }
    return this;
  }
}
```

æµ‹è¯•ï¼š

``` js
$('.list').each((ele, index) => {
  console.log(ele, index)
})
```

![each](assets/img/2020-11-29-18-50-00.png)

3ï¼‰.find(selectors)ï¼ˆæŸ¥æ‰¾å…ƒç´ ï¼‰

éå†å…ƒç´ é‡Œåˆ—è¡¨ï¼ˆæ•°ç»„ç±»å‹ï¼‰ï¼Œæ ¹æ®æŒ‡å®šçš„ CSS é€‰æ‹©å™¨é€‰æ‹©å…ƒç´ ï¼Œè¿”å› jQuery å¯¹è±¡

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArray).find(selectors)
```

å‚æ•°ï¼š

* `selectorsOrArray`ï¼šå­—ç¬¦ä¸² or æ•°ç»„
* `selectors`ï¼šå­—ç¬¦ä¸²ï¼Œé€‰æ‹©å™¨ or é€‰æ‹©å™¨ç»„

å®ç°ï¼š

``` js
{
  find(selectors) {
    const array = [];
    this.each((element) => {
      array.push(...element.querySelectorAll(selectors));
    });
    array.oldApi = this;
    return jQuery(array);
  }
}
```

æµ‹è¯•ï¼š

å­—ç¬¦ä¸²é€‰æ‹©å™¨ï¼š

``` js
$('.container1').find('#one')
$('.container1').find('.list')
$('.container2').find('.list')
```

å…ƒç´ åˆ—è¡¨ï¼ˆæ•°ç»„ç±»å‹çš„ï¼Œå¯ä¸æ˜¯`NodeList`è¿™æ ·çš„ä¼ªæ•°ç»„ï¼‰ï¼š

![æ•°ç»„ç±»å‹çš„å…ƒç´ åˆ—è¡¨](assets/img/2020-11-30-00-02-28.png)

4ï¼‰.end()ï¼ˆå…ƒç´ å›é€€ï¼‰
