### âœï¸ Tangxt â³ 2020-11-29 ğŸ·ï¸ DOM

# 02-DOM å°è£…-é“¾å¼é£æ ¼

## â˜…Q&A

ğŸ’¡ï¼šä¸ºä»€ä¹ˆè¦ç”¨é“¾å¼å§¿åŠ¿å°è£…ä¸€ä¸ª DOM åº“ï¼Ÿ

å› ä¸ºæˆ‘æƒ³è¿›ä¸€æ­¥ç†è§£ jQuery çš„è®¾è®¡æ€æƒ³

ğŸ’¡ï¼šé“¾å¼é£æ ¼æ˜¯ä»€ä¹ˆï¼Ÿ

é“¾å¼é£æ ¼ä¹Ÿç§°ä½œ jQuery é£æ ¼ï¼Œä¸å¯¹è±¡é£æ ¼ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬å…¨å±€å˜é‡ `jQuery` æ˜¯ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬åœ¨ `jQuery` å‡½æ•°çš„åŸå‹ä¸Šï¼Œä¹Ÿå°±æ˜¯ `prototype` æ——ä¸‹ï¼Œæ·»åŠ äº†å¯¹å…ƒç´ **å¢åˆ æ”¹æŸ¥**çš„åŠŸèƒ½ï¼

ğŸ’¡ï¼šä¸ºä»€ä¹ˆç”¨ `$` ä½œä¸º `jQuery` çš„åˆ«åï¼Ÿ

å› ä¸ºå®ƒå¤ŸçŸ­å‘€ï¼

ğŸ’¡ï¼šå¦‚ä½•å®ç°é“¾å¼æ“ä½œï¼Ÿ

ä¸ºäº†å®ç°é“¾å¼æ“ä½œï¼Œåœ¨ä½¿ç”¨ `jQuery("é€‰æ‹©å™¨")` æˆ– `$("é€‰æ‹©å™¨")` é€‰æ‹©é¡µé¢å…ƒç´ æ—¶ï¼Œåº”å½“è¿”å›ä¸€ä¸ªå¯æ“ä½œå¯¹åº”å…ƒç´ çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯å…ƒç´ æœ¬èº«ã€‚æˆ‘ä»¬ç§°è¿™ä¸ªå¯¹è±¡ä¸ºç”± jQuery å‡½æ•°æ„é€ çš„å¯¹è±¡ï¼Œç®€ç§°ä¸º **jQuery å¯¹è±¡**ã€‚

åœ¨ jQuery å¯¹è±¡ä¸­æ·»åŠ  `print` å±æ€§ï¼Œå±æ€§å€¼ä¸ºä¸€ä¸ªç”¨äºæ‰“å°å‡ºé€‰æ‹©å…ƒç´ çš„å‡½æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼ä¸º `this` ï¼ŒæŒ‡å‘è°ƒç”¨å®ƒçš„å¯¹è±¡ï¼Œå³ä½œä¸º jQuery å‡½æ•°è¿”å›å€¼çš„ jQuery å¯¹è±¡ã€‚å‡½æ•°ä¸é€‰æ‹©çš„å…ƒç´ æ„æˆé—­åŒ…ç»“æ„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»§ç»­å¯¹å…ƒç´ è¿›è¡Œæ“ä½œï¼Œä»è€Œå½¢æˆé“¾å¼é£æ ¼

``` js
window.$ = window.jQuery = function(selectors) {
  let elements = document.querySelectorAll(selectors)
  return {
    print() {
      console.log(elements)
      return this
    }
  }
}

// é€‰æ‹© class å±æ€§ä¸º list çš„æ‰€æœ‰å…ƒç´ å¹¶å°†å®ƒä»¬æ‰“å°å‡ºæ¥
$(".list").print()
```

ğŸ’¡ï¼šå†…å­˜ä¼˜åŒ–å¤„ç†ï¼Ÿ

æ¯æ¬¡è°ƒç”¨ jQuery å¯¹è±¡ä¸­çš„å‡½æ•°éƒ½ä¼š**æ–°å ç”¨ä¸€å—åœ°å€**ï¼Œä»è€Œå¯¼è‡´å†…å­˜æµªè´¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ï¼š

1. æŠŠ jQuery å¯¹è±¡çš„å…±æœ‰å±æ€§ï¼ˆå‡½æ•°ï¼‰å…¨éƒ¨æ”¾åœ¨ `jQuery.prototype` ä¸Š -> å¯¹å…¶ä½¿ç”¨åˆ«å `jQuery.fn = jQuery.prototype` -> å°† jQuery å¯¹è±¡çš„åŸå‹æŒ‡å‘ `jQuery.fn`ï¼ˆè¿™ä¸€æ­¥çœŸå¾—æœ‰å¿…è¦å—ï¼Ÿ`Object.create(jQuery.fn)`ï¼Ÿï¼‰ -> ä½¿ç”¨ `constructor` è®¾ç½® jQuery å¯¹è±¡çš„æ„é€ å‡½æ•° `jQuery`

2. ä½¿ç”¨ `Object.assign` ä¸º jQuery å¯¹è±¡æ·»åŠ å¤šä¸ªå±æ€§

æˆ‘ä»¬å†™çš„ API éƒ½åœ¨ jQuery å¯¹è±¡çš„åŸå‹å¯¹è±¡ä¸Šï¼Œä¹Ÿå°±æ˜¯åœ¨ `jQuery.prototype` æ——ä¸‹ï¼

## â˜…æŸ¥

### <mark>1ï¼‰$(selectors)ï¼ˆé€‰æ‹©å…ƒç´ ï¼‰</mark>

æ ¹æ®æŒ‡å®šçš„ CSS é€‰æ‹©å™¨é€‰æ‹©æ‰€æœ‰å…ƒç´ ï¼Œè¿”å› jQuery å¯¹è±¡ã€‚

è¯­æ³•ï¼š

``` js
const $api = $(selectors)
```

å‚æ•°ï¼š

* `selectors`ï¼šå­—ç¬¦ä¸²ï¼Œä¸€ä¸ªåŒ…å«å•ä¸ªæˆ–å¤šä¸ªåŒ¹é…çš„é€‰æ‹©å™¨çš„å­—ç¬¦ä¸²

å®ç°ï¼š

``` js
// åˆ«å
window.$ = window.jQuery = function(selectorsOrArrayOrTemplate) {
  let elements;
  // é‡è½½
  if (typeof selectorsOrArrayOrTemplate === "string") {
    if (selectorsOrArrayOrTemplate[0] === "<") {
      elements = [create(selectorsOrArrayOrTemplate)];
    } else {
      elements = document.querySelectorAll(selectorsOrArrayOrTemplate);
    }
  } else if (selectorsOrArrayOrTemplate instanceof Array) {
    elements = selectorsOrArrayOrTemplate;
  }

  function create(string) {
    const template = document.createElement("template");
    template.innerHTML = string.trim();
    return template.content.firstChild;
  }
  // jQuery å¯¹è±¡çš„å…±æœ‰å±æ€§
  const api = Object.create(jQuery.prototype);
  Object.assign(api, {
    elements: elements,
    oldApi: selectorsOrArrayOrTemplate.oldApi,
    jquery: true,
  });
  // é—­åŒ…
  return api;
};
```

> `oldApi` æ˜¯æ—§çš„ jQuery å¯¹è±¡ï¼Œæ¯æ¬¡ä½ è°ƒç”¨ APIï¼Œéƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ jQuery å¯¹è±¡ï¼

ä¸€ä¸ªç–‘é—®ï¼š `elements` è¿™ä¸ªå±æ€§çš„ç±»å‹æ˜¯ä¸æ˜¯åªæ˜¯æ•°ç»„ç±»å‹æ¯”è¾ƒå¥½ï¼Ÿ

### <mark>2ï¼‰.each(fn)ï¼ˆéå†å…ƒç´ ï¼‰</mark>

éå†å…ƒç´ åˆ—è¡¨ï¼Œå¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€æ¬¡æŒ‡å®šçš„å‡½æ•°ï¼Œè¿”å› jQuery å¯¹è±¡ã€‚

è¯­æ³•ï¼š

``` js
const $api = $(selectors).each(fn(element, index))
```

å®ç°ï¼š

``` js
{
  each(fn) {
    for (let index = 0; index < this.elements.length; index++) {
      const element = this.elements[index];
      fn.call(this, element, index);
    }
    return this;
  }
}
```

æµ‹è¯•ï¼š

``` js
$('.list').each((ele, index) => {
  console.log(ele, index)
})
```

![each](assets/img/2020-11-29-18-50-00.png)

### <mark>3ï¼‰.find(selectors)ï¼ˆæŸ¥æ‰¾å…ƒç´ ï¼‰</mark>

éå†å…ƒç´ é‡Œåˆ—è¡¨ï¼ˆæ•°ç»„ç±»å‹ï¼‰ï¼Œæ ¹æ®æŒ‡å®šçš„ CSS é€‰æ‹©å™¨é€‰æ‹©å…ƒç´ ï¼Œè¿”å› jQuery å¯¹è±¡

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArray).find(selectors)
```

å‚æ•°ï¼š

* `selectorsOrArray`ï¼šå­—ç¬¦ä¸² or æ•°ç»„
* `selectors`ï¼šå­—ç¬¦ä¸²ï¼Œé€‰æ‹©å™¨ or é€‰æ‹©å™¨ç»„

å®ç°ï¼š

``` js
{
  find(selectors) {
    const array = [];
    this.each((element) => {
      array.push(...element.querySelectorAll(selectors));
    });
    array.oldApi = this;
    return jQuery(array);
  }
}
```

æµ‹è¯•ï¼š

å­—ç¬¦ä¸²é€‰æ‹©å™¨ï¼š

``` js
$('.container1').find('#one')
$('.container1').find('.list')
$('.container2').find('.list')
```

å…ƒç´ åˆ—è¡¨ï¼ˆæ•°ç»„ç±»å‹çš„ï¼Œå¯ä¸æ˜¯ `NodeList` è¿™æ ·çš„ä¼ªæ•°ç»„ï¼‰ï¼š

![æ•°ç»„ç±»å‹çš„å…ƒç´ åˆ—è¡¨](assets/img/2020-11-30-00-02-28.png)

### <mark>4ï¼‰.end()ï¼ˆå…ƒç´ å›é€€ï¼‰</mark>

ç»ˆæ­¢å½“å‰é“¾çš„æ“ä½œï¼Œè¿”å›ä¸Šä¸€å±‚çš„ jQuery å¯¹è±¡ã€‚

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArray).end()
const $oldApi = $(selectorsOrArray).find(selectors).end()
```

å®ç°ï¼š

``` js
{
  end() {
    return this.oldApi || this;
  }
}
```

æµ‹è¯•ï¼š

![end æ–¹æ³•æµ‹è¯•](assets/img/2020-11-30-12-22-26.png)

### <mark>5ï¼‰.get(index)ï¼ˆè·å–å•ä¸ªèŠ‚ç‚¹å…ƒç´ å¯¹è±¡ï¼‰</mark>

é€šè¿‡ jQuery å¯¹è±¡è·å–æŒ‡å®šç´¢å¼•çš„ DOM èŠ‚ç‚¹ã€‚

è¯­æ³•ï¼š

``` js
const elNode = $(selectorsOrArray).get(index)
```

å‚æ•°ï¼š

* `index`ï¼šæ•°å€¼ç±»å‹ï¼Œè¡¨ç¤ºæŒ‡å®šçš„ç´¢å¼•å€¼ï¼Œè‹¥ä¸ºè´Ÿæ•°ï¼Œå¦‚`-1`ï¼Œåˆ™æ˜¯å€’æ•°ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè‹¥è´Ÿå€¼è¿‡å°ï¼Œé‚£å°±æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ŒåŒç†ï¼Œè‹¥å€¼è¿‡å¤§ï¼Œé‚£å°±æ˜¯æœ€åä¸€ä¸ªå…ƒç´ 

å®ç°ï¼š

``` js
{
  get(index) {
    const length = this.elements.length;
    if (index < 0) {
      index = index + length < 0 ? 0 : index + length;
    } else if (index >= length) {
      index = length - 1;
    }
    return this.elements[index];
  }
}
```

æµ‹è¯•ï¼š

![æµ‹è¯•](assets/img/2020-11-30-12-57-23.png)

### <mark>6ï¼‰.eq(index)ï¼ˆè·å– jQuery åŒ–çš„å•ä¸ªå…ƒç´ èŠ‚ç‚¹ï¼‰</mark>

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArray).eq(index)
```

å®ç°ï¼š

``` js
{
  eq(index) {
    const length = this.elements.length;
    if (index < 0) {
      index = index + length < 0 ? 0 : index + length;
    } else if (index >= length) {
      index = length - 1;
    }
    return jQuery([this.elements[index]]);
  }
}
```

æµ‹è¯•ï¼š

![æµ‹è¯• eq](assets/img/2020-11-30-14-22-36.png)

### <mark>7ï¼‰.parent()ï¼ˆé€‰æ‹©çˆ¶å…ƒç´ ï¼‰</mark>

éå†å…ƒç´ åˆ—è¡¨ï¼Œå¾—åˆ°æ¯ä¸ªå…ƒç´ çš„çˆ¶å…ƒç´ ï¼ˆå»é‡ï¼‰ï¼Œè¿”å› jQuery å¯¹è±¡

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArray).parent()
```

å®ç°ï¼š

``` js
{
  parent() {
    const array = [];
    this.each((element) => {
      const parentElement = element.parentNode;
      if (array.indexOf(parentElement) === -1) {
        array.push(parentElement);
      }
    });
    array.oldApi = this;
    return jQuery(array);
  }
}
```

æµ‹è¯•ï¼š

![parent](assets/img/2020-11-30-15-14-25.png)

ğŸ’¡ï¼š `NodeList` vs `HTMLCollection` ï¼Ÿ

å†å²ä¸Šçš„ DOM é›†åˆæ¥å£ã€‚ä¸»è¦ä¸åŒåœ¨äº `HTMLCollection` æ˜¯å…ƒç´ é›†åˆè€Œ `NodeList` æ˜¯èŠ‚ç‚¹é›†åˆï¼ˆå³å¯ä»¥åŒ…å«å…ƒç´ ï¼Œä¹Ÿå¯ä»¥åŒ…å«æ–‡æœ¬èŠ‚ç‚¹ï¼‰ã€‚æ‰€ä»¥ `node.childNodes` è¿”å› `NodeList` ï¼Œè€Œ `node.children` å’Œ `node` . `getElementsByXXX` è¿”å› `HTMLCollection` ã€‚

**å”¯ä¸€è¦æ³¨æ„çš„æ˜¯ `querySelectorAll` è¿”å›çš„è™½ç„¶æ˜¯ `NodeList` ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯å…ƒç´ é›†åˆ**ï¼Œå¹¶ä¸”æ˜¯é™æ€çš„ï¼ˆå…¶ä»–æ¥å£è¿”å›çš„ `HTMLCollection` å’Œ `NodeList` éƒ½æ˜¯ live çš„ï¼‰ã€‚äº‹å®ä¸Šï¼Œå°†æ¥æµè§ˆå™¨å°†å¢åŠ  `queryAll` æ¥å£å–ä»£ç°åœ¨çš„ `querySelectorAll` ï¼Œè¿”å› `Elements` æ˜¯ `Array` çš„å­ç±»ï¼ˆå› è€Œå¯ä»¥ä½¿ç”¨ `Array` ä¸Šçš„ `forEach` ã€ `map` ç­‰æ–¹æ³•ï¼‰ã€‚

â¹ï¼š[NodeList å’Œ HTMLCollection ä¹‹é—´çš„å…³ç³»ï¼Ÿ - è´ºå¸ˆä¿Šçš„å›ç­” - çŸ¥ä¹](https://www.zhihu.com/question/31576889/answer/52559370)

### <mark>8ï¼‰.children()ï¼ˆé€‰æ‹©å­å…ƒç´ ä»¬ï¼‰</mark>

éå†å…ƒç´ åˆ—è¡¨ï¼Œé€‰æ‹©æ¯ä¸€ä¸ªå…ƒç´ çš„å­å…ƒç´ ï¼Œè¿”å› jQuery å¯¹è±¡ã€‚

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArray).children()
```

å®ç°ï¼š

``` js
{
  children() {
    const array = [];
    this.each((element) => {
      array.push(...element.children);
    });
    array.oldApi = this;
    return jQuery(array);
  }
}
```

æµ‹è¯•ï¼š

![å­å…ƒç´ ä»¬](assets/img/2020-11-30-16-13-16.png)

### <mark>9ï¼‰.siblings()ï¼ˆé€‰æ‹©åŒçº§å…ƒç´ ï¼‰</mark>

éå†å…ƒç´ åˆ—è¡¨ï¼Œé€‰æ‹©æ¯ä¸€ä¸ªå…ƒç´ çš„åŒçº§å…ƒç´ ä»¬ï¼Œè¿”å› jQuery å¯¹è±¡ã€‚

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArray).siblings()
```

å®ç°ï¼š

``` js
{
  siblings() {
    const array = [];
    this.each((element) => {
      const siblingsElements = Array.from(element.parentNode.children).filter(
        (item) => item !== element
      );
      array.push(...siblingsElements);
    });
    array.oldApi = this;
    return jQuery(array);
  }
}
```

æµ‹è¯•ï¼š

![siblings](assets/img/2020-11-30-16-20-14.png)

### <mark>10ï¼‰.prev()ï¼ˆé€‰æ‹©å‰ä¸€ä¸ªåŒçº§å…ƒç´ ï¼‰</mark>

éå†å…ƒç´ åˆ—è¡¨ï¼Œé€‰æ‹©æ¯ä¸€ä¸ªå…ƒç´ çš„å‰ä¸€ä¸ªåŒçº§éæ–‡æœ¬å…ƒç´ ï¼Œè¿”å› jQuery å¯¹è±¡ã€‚

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArray).prev()
```

å®ç°ï¼š

``` js
{
  prev() {
    const array = [];
    this.each((element) => {
      let p = element.previousSibling;
      while (p && p.nodeType === 3) {
        p = p.previousSibling;
      }
      array.push(p);
    });
    array.oldApi = this;
    return jQuery(array);
  }
}
```

æµ‹è¯•ï¼š

![æµ‹è¯•](assets/img/2020-11-30-21-08-41.png)

### <mark>11ï¼‰.next()ï¼ˆé€‰æ‹©åä¸€ä¸ªåŒçº§å…ƒç´ ï¼‰</mark>

éå†å…ƒç´ åˆ—è¡¨ï¼Œé€‰æ‹©æ¯ä¸€ä¸ªå…ƒç´ çš„å‰ä¸€ä¸ªåŒçº§éæ–‡æœ¬å…ƒç´ ï¼Œè¿”å› jQuery å¯¹è±¡ã€‚

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArray).prev()
```

å®ç°ï¼š

``` js
{
  next() {
    const array = [];
    this.each((element) => {
      let n = element.nextSibling;
      while (n && n.nodeType === 3) {
        n = n.nextSibling;
      }
      array.push(n);
    });
    array.oldApi = this;
    return jQuery(array);
  }
}
```

## â˜…å¢

### <mark>1ï¼‰$(template)ï¼ˆåˆ›å»ºå…ƒç´ ï¼‰</mark>

æ ¹æ®æŒ‡å®šçš„ HTML å­—ç¬¦ä¸²æ¨¡æ¿åˆ›å»ºå¹¶é€‰æ‹©å…ƒç´ ï¼Œè¿”å› jQuery å¯¹è±¡

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArrayOrTemplate)
```

å®ç°ï¼š

``` js
window.$ = window.jQuery = function(selectorsOrArrayOrTemplate) {
  let elements
  if (typeof selectorsOrArrayOrTemplate === "string") {
    if (selectorsOrArrayOrTemplate[0] === "<") {
      elements = [create(selectorsOrArrayOrTemplate)]
    } else {
      elements = document.querySelectorAll(selectorsOrArrayOrTemplate)
    }
  } else if (selectorsOrArrayOrTemplate instanceof Array) {
    elements = selectorsOrArrayOrTemplate
  }

  function create(string) {
    const template = document.createElement("template")
    template.innerHTML = string.trim()
    return template.content.firstChild
  }
  return {
    oldApi: selectorsOrArrayOrTemplate.oldApi,
    elements: elements
  }
}
```

æµ‹è¯•ï¼š

![template](assets/img/2020-11-30-21-21-42.png)

### <mark>2ï¼‰.before(jQueryOrNode)ï¼ˆå‘å‰æ’å…¥å…ƒç´ ï¼‰</mark>

å°†æŒ‡å®šå…ƒç´ ä½œä¸ºæ‰€é€‰æ‹©å…ƒç´ çš„å‰ä¸€ä¸ªèŠ‚ç‚¹

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArrayOrTemplate).before(jQueryOrNode)
```

å‚æ•°ï¼š

* `jQueryOrNode`ï¼šjQuery å¯¹è±¡æˆ–è€…èŠ‚ç‚¹å¯¹è±¡ï¼Œè¡¨ç¤ºéœ€è¦æ’å…¥çš„å…ƒç´ æˆ–è€… DOM èŠ‚ç‚¹

å®ç°ï¼š

``` js
{
  before(jQueryOrNode) {
    const element = this.get(0);
    if (jQueryOrNode.jquery) {
      element.parentNode.insertBefore(jQueryOrNode.get(0), element);
    } else if (jQueryOrNode instanceof Node) {
      element.parentNode.insertBefore(jQueryOrNode, element);
    }
    return this;
  }
}
```

> jQuery å¯¹è±¡éƒ½æœ‰ä¸ª jquery å±æ€§ï¼Œè€Œè¯¥å±æ€§æ˜¯ç”¨äºåŒºåˆ†è¿™æ˜¯ jQuery å¯¹è±¡è¿˜æ˜¯ DOM èŠ‚ç‚¹çš„ï¼

æµ‹è¯•ï¼š

![before](assets/img/2020-11-30-21-36-14.png)

### <mark>3ï¼‰.after(jQueryOrNode)ï¼ˆå‘åæ’å…¥å…ƒç´ ï¼‰</mark>

å°†æŒ‡å®šå…ƒç´ ä½œä¸ºæ‰€é€‰æ‹©å…ƒç´ çš„åä¸€ä¸ªèŠ‚ç‚¹ã€‚

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArrayOrTemplate).after(jQueryOrNode)
```

å®ç°ï¼š

``` js
{
  after(jQueryOrNode) {
    const element = this.get(0);
    if (jQueryOrNode.jquery) {
      element.parentNode.insertBefore(
        jQueryOrNode.get(0),
        jQuery([element]).next().get(0)
      );
    } else if (jQueryOrNode instanceof Node) {
      element.parentNode.insertBefore(
        jQueryOrNode,
        jQuery([element]).next().get(0)
      );
    }
    return this;
  }
}
```

> åŸºäº `insertBefore` å®ç°ï¼Œ `insertBefore` çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å‚è€ƒèŠ‚ç‚¹ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œæ˜¯æ‹¿åˆ°äº†é€‰æ‹©å…ƒç´ çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å…ƒç´ å¯¹è±¡ï¼

ä¸€ä¸ªç–‘é—®ï¼Œå‚è€ƒèŠ‚ç‚¹æ˜¯ `null` ï¼Œé‚£ä¹ˆ `insertBefore(jQueryOrNode,null)` æ˜¯å¦‚ä½•æ’å…¥çš„ï¼Ÿ

> If `referenceNode` is `null` , then `newNode` is inserted at the end of `parentNode` 's child nodes.

æµ‹è¯•ï¼š

![after](assets/img/2020-11-30-21-47-35.png)

### <mark>4ï¼‰.append(jQueryOrNode)ï¼ˆæ’å…¥å­å…ƒç´ ï¼‰</mark>

å°†æŒ‡å®šå…ƒç´ ä½œä¸ºæ‰€é€‰æ‹©å…ƒç´ çš„æœ«ä½å­èŠ‚ç‚¹

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArrayOrTemplate).append(jQueryOrNode)
```

å®ç°ï¼š

``` js
{
  append(jQueryOrNode) {
    const element = this.get(0);
    if (jQueryOrNode.jquery) {
      element.appendChild(jQueryOrNode.get(0));
    } else if (jQueryOrNode instanceof Node) {
      element.appendChild(jQueryOrNode);
    }
    return this;
  }
}
```

æµ‹è¯•ï¼š

![append](assets/img/2020-11-30-23-44-01.png)

### <mark>5ï¼‰.appendTo(jQueryOrNode)ï¼ˆæ’å…¥å­å…ƒç´ ä¹‹é€†æ“ä½œï¼‰</mark>

å°†æ‰€é€‰æ‹©å…ƒç´ ä½œä¸ºæŒ‡å®šå…ƒç´ çš„æœ«ä½å­èŠ‚ç‚¹ã€‚

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArrayOrTemplate).appendTo(jQueryOrNode)
```

å®ç°ï¼š

``` js
{
  appendTo(jQueryOrNode) {
    const element = this.get(0);
    if (jQueryOrNode.jquery) {
      jQueryOrNode.get(0).appendChild(element);
    } else if (jQueryOrNode instanceof Node) {
      jQueryOrNode.appendChild(element);
    }
    return this;
  }
}
```

> å®ç°åŸç†ï¼šè°ƒç”¨ `appendChild` çš„æ˜¯æŒ‡å®šå…ƒç´ èŠ‚ç‚¹å¯¹è±¡ï¼å¯ä¸æ˜¯æˆ‘ä»¬ç”¨ jQuery å‡½æ•°é€‰æ‹©çš„å…ƒç´ 

æµ‹è¯•ï¼š

![appendTo](assets/img/2020-11-30-23-54-53.png)

## â˜…åˆ 

### <mark>1ï¼‰.remove()ï¼ˆåˆ é™¤å…ƒç´ ï¼‰</mark>

éå†å…ƒç´ åˆ—è¡¨å¹¶åˆ é™¤å…¶ä¸­æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿”å› jQuery å¯¹è±¡

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArrayOrTemplate).remove()
```

å®ç°ï¼š

``` js
{
  remove() {
    this.each((element) => {
      element.remove();
    });
    return this;
  }
}
```

æµ‹è¯•ï¼š

![remove](assets/img/2020-12-01-00-30-23.png)

### <mark>2ï¼‰.empty()ï¼ˆæ¸…ç©ºå­å…ƒç´ ï¼‰</mark>

éå†å…ƒç´ åˆ—è¡¨å¹¶åˆ é™¤å…¶ä¸­æ‰€æœ‰å…ƒç´ çš„å­èŠ‚ç‚¹ï¼Œè¿”å› jQuery å¯¹è±¡ã€‚

è¯­æ³•ï¼š

``` js
const $api = $(selectorsOrArrayOrTemplate).empty()
```

å®ç°ï¼š

``` js
{
  empty() {
    this.each((element) => {
      console.log(element.children)
      const children = Array.from(element.children);
      for (let i = 0; i < children.length; i++) {
        children[i].remove();
      }
    });
    return this;
  }
}
```

æµ‹è¯•ï¼š

![empty](assets/img/2020-12-01-00-35-43.png)

> æ‰¹é‡æ¸…ç©ºï¼š `$('ul').empty()` -> `$('ul')` ä¼šé€‰ä¸­ä¸¤ä¸ªå…ƒç´ ï¼Œæˆ‘ä»¬éå†ä¹‹ï¼Œå¯¹æ¯ä¸ªå…ƒç´ æ——ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½æ‰§è¡Œä¸€ä¸ª `remove` æ–¹æ³•â€¦â€¦

## â˜…æ”¹

### <mark>1ï¼‰attr(name, value)ï¼ˆè¯»å†™ç‰¹æ€§ï¼‰</mark>

è¿”å›æˆ–ä¿®æ”¹æ‰€é€‰å…ƒç´ çš„æŒ‡å®šç‰¹æ€§å€¼

è¯­æ³•ï¼š

``` js
const attributeValue = $(selectorsOrArrayOrTemplate).attr(name)
const $api = $(selectorsOrArrayOrTemplate).attr(name, value)
```

å®ç°ï¼š

``` js
{
  attr(name, value) {
    // é‡è½½
    if (arguments.length === 1) {
      return this.get(0).getAttribute(name);
    } else if (arguments.length === 2) {
      this.each((element) => {
        element.setAttribute(name, value);
      });
    }
    return this;
  }
}
```

æµ‹è¯•ï¼š

![ç‰¹æ€§å€¼](assets/img/2020-12-01-11-21-44.png)

### <mark>2ï¼‰.css(name, value)ï¼ˆè¯»å†™ style å±æ€§ï¼‰</mark>

è¿”å›æˆ–ä¿®æ”¹æ‰€é€‰å…ƒç´ çš„æŒ‡å®šæ ·å¼å±æ€§å€¼ã€‚

è¯­æ³•ï¼š

``` js
const styleValue = $(selectorsOrArrayOrTemplate).css(name)
const $api = $(selectorsOrArrayOrTemplate).css(name, value)
```

å®ç°ï¼š

``` js
{
  css(name, value) {
    // é‡è½½
    if (arguments.length === 1) {
      if (typeof name === "string") {
        return this.get(0).style[name];
      } else if (name instanceof Object) {
        this.each((element) => {
          for (let key in name) {
            element.style[key] = name[key];
          }
        });
      }
    } else if (arguments.length === 2) {
      this.each((element) => {
        element.style[name] = value;
      });
    }
    return this;
  }
}
```

æµ‹è¯•ï¼š

![css](assets/img/2020-12-01-11-35-05.png)

### <mark>3ï¼‰è¯»å†™ class å±æ€§</mark>

#### <mark>1ã€.hasClass(className)ï¼ˆåˆ¤æ–­ class å±æ€§ï¼‰</mark>

åˆ¤æ–­å…ƒç´ åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ class å±æ€§æ˜¯å¦åŒ…å«ç›¸åº”çš„å­—ç¬¦ä¸²ï¼Œè¿”å›å¸ƒå°”å€¼ã€‚

#### <mark>2ã€.addClass(className)ï¼ˆæ·»åŠ ä¸€ä¸ª class ï¼‰</mark>

éå†å…ƒç´ åˆ—è¡¨ï¼Œä¸ºå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ åˆ›å»º or è¿½åŠ ä¸€ä¸ª class

#### <mark>3ã€.removeClass(className)ï¼ˆåˆ é™¤ä¸€ä¸ª classï¼‰</mark>

éå†å…ƒç´ åˆ—è¡¨ï¼Œä¸ºå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ åˆ é™¤ä¸€ä¸ª class 

è¯­æ³•ï¼š

``` js
let bool = $(selectorsOrArrayOrTemplate).hasClass(className)
let $api = $(selectorsOrArrayOrTemplate).addClass(className)
let $api = $(selectorsOrArrayOrTemplate).removeClass(className)
```

å®ç°ï¼š

``` js
{
  hasClass(className) {
      return this.get(0).classList.contains(className);
    },
    addClass(className) {
      this.each((element) => {
        element.classList.add(className);
      });
      return this;
    },
    removeClass(className) {
      this.each((element) => {
        element.classList.remove(className);
      });
      return this;
    }
}
```

æ³¨æ„ï¼Œä½ ä¸èƒ½ä¸€æ¬¡æ€§è¿½åŠ ä¸¤ä¸ª `class` ï¼š

![class è¿½åŠ ](assets/img/2020-12-01-11-59-08.png)

æµ‹è¯•ï¼š

![è¯»å†™ class å±æ€§](assets/img/2020-12-01-11-53-33.png)

### <mark>4ï¼‰.text(textString)ï¼ˆè¯»å†™æ–‡æœ¬å†…å®¹ï¼‰</mark>

è¿”å›æˆ–ä¿®æ”¹æ‰€é€‰å…ƒç´ çš„æ–‡æœ¬å†…å®¹

``` js
let text = $(selectorsOrArrayOrTemplate).text()
const $api = $(selectorsOrArrayOrTemplate).text(textString)
```

å®ç°ï¼š

``` js
{
  text(textString) {
    // é‡è½½
    if (arguments.length === 0) {
      let string = "";
      this.each((element) => {
        // é€‚é…
        string += document.all ? element.innerText : element.textContent;
      });
      return string;
    } else if (arguments.length === 1) {
      this.each((element) => {
        document.all ?
          (element.innerText = textString) :
          (element.textContent = textString);
      });
    }
    return this;
  }
}
```

æµ‹è¯•ï¼š

![text](assets/img/2020-12-01-12-33-17.png)

### <mark>5ï¼‰.html(htmlString)ï¼ˆè¯»å†™ HTML å†…å®¹ï¼‰</mark>

è¿”å›æˆ–ä¿®æ”¹æ‰€é€‰å…ƒç´ çš„ HTML å†…å®¹

è¯­æ³•ï¼š

``` js
let html = $(selectorsOrArrayOrTemplate).html()
const $api = $(selectorsOrArrayOrTemplate).html(htmlString)
```

å®ç°ï¼š

``` js
{
  html(htmlString) {
    // é‡è½½
    if (arguments.length === 0) {
      return this.get(0).innerHTML;
    } else if (arguments.length === 1) {
      this.each((element) => {
        element.innerHTML = htmlString;
      });
    }
    return this;
  }
}
```

> é‡è½½ï¼šå½“ä¸ä¼ å…¥å‚æ•°æ—¶ï¼Œè¯»å–å…ƒç´ åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„ HTML å†…å®¹ï¼›å½“ä¼ å…¥ä¸€ä¸ªå‚æ•°æ—¶ï¼Œä¿®æ”¹å…ƒç´ åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„ HTML å†…å®¹

æµ‹è¯•ï¼š

![html](assets/img/2020-12-01-15-13-48.png)

### <mark>6ï¼‰äº‹ä»¶ç›‘å¬</mark>

#### <mark>1ã€.on(eventType, listener, useCapture)ï¼ˆç»‘å®šäº‹ä»¶ç›‘å¬ï¼‰</mark>

éå†å…ƒç´ åˆ—è¡¨ï¼Œä¸ºå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ ç»‘å®šäº‹ä»¶ç›‘å¬å‡½æ•°ã€‚

#### <mark>2ã€.off(eventType, listener, useCapture)ï¼ˆåˆ é™¤äº‹ä»¶ç›‘å¬ï¼‰</mark>

éå†å…ƒç´ åˆ—è¡¨ï¼Œä¸ºå…¶ä¸­æ¯ä¸€ä¸ªå…ƒç´ åˆ é™¤äº‹ä»¶ç›‘å¬å‡½æ•°ã€‚

---

è¯­æ³•ï¼š

``` js
let $api = $(selectorsOrArrayOrTemplate).on(eventType, listener, useCapture)
let $api = $(selectorsOrArrayOrTemplate).off(eventType, listener, useCapture)
```

å®ç°ï¼š

``` js
{
  on(eventType, listener, useCapture = false) {
      this.each((element) => {
        element.addEventListener(eventType, listener, useCapture);
      });
      return this;
    },
    off(eventType, listener, useCapture = false) {
      this.each((element) => {
        element.removeEventListener(eventType, listener, useCapture);
      });
      return this;
    }
}
```

æµ‹è¯•ï¼š

æˆ‘ç”¨äº†è¿™æ ·çš„æµ‹è¯•ä»£ç ï¼š

``` js
function alertContent(e) {
  alert($(this).text())
  $(this).off('click', alertContent)
}

$('.list').on('click', alertContent)
```

> æˆ‘æ¯ä¸ª`li.list`å…ƒç´ æ·»åŠ ä¸€ä¸ª`click`äº‹ä»¶ï¼Œäº‹ä»¶è§¦å‘å°±ä¼šå¼¹å‡ºè¿™ä¸ªå…ƒç´ çš„æ–‡æœ¬å†…å®¹ï¼Œå¹¶ä¸”åˆ é™¤è¿™ä¸ªäº‹ä»¶ç›‘å¬å‡½æ•°ï¼Œæ¢è¨€ä¹‹ï¼Œåªç›‘å¬ä¸€æ¬¡ï¼Œå°±æŠŠè¿™ä¸ª`alertContent`ç»™ GG äº†

æˆ‘ä»¬è¿™ä¸ª `$` å‡½æ•°æ˜¯æ— æ³•å¤„ç†å…ƒç´ èŠ‚ç‚¹å¯¹è±¡çš„ï¼Œäºæ˜¯æˆ‘å°±åŠ äº†ä¸€ä¸ª `if...else...` :

``` js
if (selectorsOrArrayOrTemplate instanceof HTMLElement) {
  elements = [selectorsOrArrayOrTemplate]
}
```

## â˜…å‚è€ƒæ–‡ç« 

1. [jQuery API ä¸­æ–‡æ–‡æ¡£](https://www.jquery123.com/)
2. [é˜®ä¸€å³° jQuery è®¾è®¡æ€æƒ³](http://www.ruanyifeng.com/blog/2011/07/jquery_fundamentals.html)
3. [æ–¹åº”æ­ jQuery éƒ½è¿‡æ—¶äº†ï¼Œé‚£æˆ‘è¿˜å­¦å®ƒå¹²å˜›ï¼Ÿ](https://fangyinghang.com/why-still-jquery/)
4. [Woozyzzz DOM å°è£…-å¯¹è±¡é£æ ¼](https://www.yuque.com/woozyzzz/ybz8i1/yo9rg6)